{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"Welcome to the Gyroflow Docs! Return to gyroflow.xyz Here you can find information about setup and configuration of the Gyroflow stabilization software. What is Gyroflow? In order to achieve smooth, cinematic footage, video stabilization is often essential. For cinema cameras, this is often achieved using motorized gimbals or other bulky camera stabilizers. Phone cameras and compact action cameras on the other hand use Electronic Image Stabilization (EIS) applied in real-time based on gyro sensor data. Finally, video editing packages can often stabilize video based on estimated camera motion, which may be unreliable. This is where Gyroflow comes into play. Gyroflow is a post-processing video stabilization software based on logged motion data. With the help of precise lens calibrations, rolling shutter correction, and tweakable stabilization algorithms (including horizon levelling), Gyroflow can produce gimbal-like stabilization with no or minimal weight penalty. It also works regardless of lighting conditions or moving subjects. This is especially suited for aerial videography, where the beta version has been extensively evaluated for large and small productions alike. With many cameras from GoPro, Sony, insta360 etc. supporting built-in motion data recording, additional hardware might not even be required. You can even use a GoPro as a logger for a cinema camera. Gyroflow is cross-platform (even supports Apple Silicon), and uses hardware acceleration for blazingly fast processing combined with a modern multilingual user interface.","title":"Home"},{"location":"#welcome-to-the-gyroflow-docs","text":"Return to gyroflow.xyz Here you can find information about setup and configuration of the Gyroflow stabilization software.","title":"Welcome to the Gyroflow Docs!"},{"location":"#what-is-gyroflow","text":"In order to achieve smooth, cinematic footage, video stabilization is often essential. For cinema cameras, this is often achieved using motorized gimbals or other bulky camera stabilizers. Phone cameras and compact action cameras on the other hand use Electronic Image Stabilization (EIS) applied in real-time based on gyro sensor data. Finally, video editing packages can often stabilize video based on estimated camera motion, which may be unreliable. This is where Gyroflow comes into play. Gyroflow is a post-processing video stabilization software based on logged motion data. With the help of precise lens calibrations, rolling shutter correction, and tweakable stabilization algorithms (including horizon levelling), Gyroflow can produce gimbal-like stabilization with no or minimal weight penalty. It also works regardless of lighting conditions or moving subjects. This is especially suited for aerial videography, where the beta version has been extensively evaluated for large and small productions alike. With many cameras from GoPro, Sony, insta360 etc. supporting built-in motion data recording, additional hardware might not even be required. You can even use a GoPro as a logger for a cinema camera. Gyroflow is cross-platform (even supports Apple Silicon), and uses hardware acceleration for blazingly fast processing combined with a modern multilingual user interface.","title":"What is Gyroflow?"},{"location":"faq/","text":"TBA","title":"FAQ"},{"location":"index_back/","text":"","title":"Home"},{"location":"cams/blackmagic/","text":"Blackmagic Pocket 4K/6K cameras recently got a firmware update in order to enable gyro metadata logging (Camera firmware 7.9). Furthermore, the latest Resolve 18 beta release has added a feature to apply gyro-based stabilization. The latest development builds of Gyroflow allow the use of BRAW with this metadata. Furthermore, Gyroflow also allows playback and analysis of BRAW footage directly, which streamlines the workflow compared to analysing a proxy. Note that Gyroflow doesn't allow rendering this footage. Instead the recommended workflow uses the OpenFX plugin in combination with Gyroflow for lossless image stabilization.","title":"Blackmagic"},{"location":"cams/general/","text":"General Welcome to Camera and Gyro Logging Guide! This page contains some useful information about camera settings and supported gyro data formats. For more details, please refer to the left navigation bar. Camera Recording Tips Use the settings that give the widest possible field of view. This results in more data to work with. For a lot of cameras, this is using the 4:3 aspect ratio if available. If using the main flight controller on a drone for logging, the camera should be rigidly mounted to the drone. If using a secondary logger on the camera or internal camera logging, some soft mounting is preferred when used in a high-vibration environment (drones). Internal stabilization should be disabled. Furthermore, trying to stabilize footage from a camera with IBIS may result in wobble due to the sensor shifting around. A 90 degree shutter is typically a good compromise between artifacts and pleasing motion blur, and is thus a good starting point. In filmmaking, the 180 degree shutter rule is commonly used (shutter speed half of framerate). Depending on your use case and amount of shake, applying Gyroflow stabilization may result in undesired motion blur artifacts. Note that even higher shutter speeds can make the footage look less \"cinematic\" due to the lack of motion blur. If you're only concerned about stabilization, a higher shutter speed is generally better. Supported gyro formats Gyroflow needs a source of gyroscope data (and optionally accelerometer data) to operate. Currently, Gyroflow supports the following gyro log types: GoPro (All models with gyro metadata, starting with HERO 5) Sony (a1, a7c, a7r IV, a7 IV, a7s III, a9 II, FX3, FX6, RX0 II, RX100 VII, ZV1, ZV-E10) Insta360 (OneR, SMO 4k, GO2) Betaflight blackbox (CSV and binary) Runcam CSV (Runcam 5 Orange, iFlight GOCam GR) Hawkeye Firefly X Lite CSV WitMotion (WT901SDCL binary and *.txt) Mobile apps: Sensor Logger , G-Field Recorder , Gyro Gyroflow .gcsv log ArduPilot VideoStabilization logging (*.log) (TODO) DJI flight logs ( .dat, .txt)","title":"General"},{"location":"cams/general/#general","text":"Welcome to Camera and Gyro Logging Guide! This page contains some useful information about camera settings and supported gyro data formats. For more details, please refer to the left navigation bar.","title":"General"},{"location":"cams/general/#camera-recording-tips","text":"Use the settings that give the widest possible field of view. This results in more data to work with. For a lot of cameras, this is using the 4:3 aspect ratio if available. If using the main flight controller on a drone for logging, the camera should be rigidly mounted to the drone. If using a secondary logger on the camera or internal camera logging, some soft mounting is preferred when used in a high-vibration environment (drones). Internal stabilization should be disabled. Furthermore, trying to stabilize footage from a camera with IBIS may result in wobble due to the sensor shifting around. A 90 degree shutter is typically a good compromise between artifacts and pleasing motion blur, and is thus a good starting point. In filmmaking, the 180 degree shutter rule is commonly used (shutter speed half of framerate). Depending on your use case and amount of shake, applying Gyroflow stabilization may result in undesired motion blur artifacts. Note that even higher shutter speeds can make the footage look less \"cinematic\" due to the lack of motion blur. If you're only concerned about stabilization, a higher shutter speed is generally better.","title":"Camera Recording Tips"},{"location":"cams/general/#supported-gyro-formats","text":"Gyroflow needs a source of gyroscope data (and optionally accelerometer data) to operate. Currently, Gyroflow supports the following gyro log types: GoPro (All models with gyro metadata, starting with HERO 5) Sony (a1, a7c, a7r IV, a7 IV, a7s III, a9 II, FX3, FX6, RX0 II, RX100 VII, ZV1, ZV-E10) Insta360 (OneR, SMO 4k, GO2) Betaflight blackbox (CSV and binary) Runcam CSV (Runcam 5 Orange, iFlight GOCam GR) Hawkeye Firefly X Lite CSV WitMotion (WT901SDCL binary and *.txt) Mobile apps: Sensor Logger , G-Field Recorder , Gyro Gyroflow .gcsv log ArduPilot VideoStabilization logging (*.log) (TODO) DJI flight logs ( .dat, .txt)","title":"Supported gyro formats"},{"location":"cams/gopro/","text":"From the GoPro Hero 5 and onwards, the GPMF metadata has contained useful motion data supported by Gyroflow. Unfortunately not all cameras work equally well: General All GoPros use 4:3 sensors and allow for different field of views. For Gyroflow stabilization, the best resolutions are 4:3 resolutions with the wide field of view. This gives Gyroflow the most image data to work with. By default, GoPro files are limited to 4 GB in size. For longer files, use either the GoPro Labs large chapter support , or use ReelSteady-Joiner to join segmented files together. Hero 8/9/10 These cameras all contain pre-computed camera orientations for every single frame, meaning the synchronisation step can be skipped when using the None integration method. Footage from these cameras are essentially \"plug and play\" when it comes to Gyroflow stabilization, since Gyroflow contains built-in lens profiles for all these cameras. Furthermore, since these cameras do internal rolling shutter processing, additional rolling shutter correction is not required. Finally, the GPMF metadata also contains transformed orientation information when hypersmooth is enabled, meaning further stabilization of hypersmoothed footage in Gyroflow is possible. Hero 7 The Hero 7 is a bit of an outlier. For drone footage, the gyro data from the Hero 7 have been found to be lackluster to say the least. High amounts of noise and aliasing means Gyroflow stabilization using the internal data is likely to give bad results. For this reason, the Hero 7 is not recommended for cinematic FPV footage. One workaround is to use external gyro logging, for instance using the drone blackbox. Another workaround is the use of vibration-dampening mount, which can be a hassle compared to other GoPros. Some users have reported that using intense low pass filtering of the gyro data (e.g. cutoff of 4 Hz or less) can yield acceptable results for some drone footage. This cannot correct for e.g. higher frequency propwash oscillations or vibrations, but can smooth out the general movement. The Hero 7 doesn't compute per-frame orientations, meaning synchronization is required. For handheld footage, the mentioned noise issues shouldn't be a problem. Furthermore, footage from the Hero 7 with Hypersmooth enabled does not work with Gyroflow. Hero 6 The Hero 6 contains gyroscope and accelerometer data, and can thus be used with Gyroflow out of the box. Due to the lack of per-frame orientations, the synchronization step is still required. The Hero 6 doesn't exhibit the noise issues of the Hero 7, and works well for drone footage. Compared to Hero 8/9/10, no internal rolling shutter processing is performed, meaning fast motion can cause warping, if no rolling shutter correction is applied in Gyroflow. Hero 5/Session 5 The Hero 5 exhibits similar vibration-induced noise problems to the Hero 7, and is thus not recommended for drone footage out of the box. Once again, users have reported achieving acceptable stabilization using intense low pass filtering, so if you already have this camera, that's worth a try. Just like the Hero 7, handheld footage doesn't yield any major problems.","title":"GoPro"},{"location":"cams/gopro/#general","text":"All GoPros use 4:3 sensors and allow for different field of views. For Gyroflow stabilization, the best resolutions are 4:3 resolutions with the wide field of view. This gives Gyroflow the most image data to work with. By default, GoPro files are limited to 4 GB in size. For longer files, use either the GoPro Labs large chapter support , or use ReelSteady-Joiner to join segmented files together.","title":"General"},{"location":"cams/gopro/#hero-8910","text":"These cameras all contain pre-computed camera orientations for every single frame, meaning the synchronisation step can be skipped when using the None integration method. Footage from these cameras are essentially \"plug and play\" when it comes to Gyroflow stabilization, since Gyroflow contains built-in lens profiles for all these cameras. Furthermore, since these cameras do internal rolling shutter processing, additional rolling shutter correction is not required. Finally, the GPMF metadata also contains transformed orientation information when hypersmooth is enabled, meaning further stabilization of hypersmoothed footage in Gyroflow is possible.","title":"Hero 8/9/10"},{"location":"cams/gopro/#hero-7","text":"The Hero 7 is a bit of an outlier. For drone footage, the gyro data from the Hero 7 have been found to be lackluster to say the least. High amounts of noise and aliasing means Gyroflow stabilization using the internal data is likely to give bad results. For this reason, the Hero 7 is not recommended for cinematic FPV footage. One workaround is to use external gyro logging, for instance using the drone blackbox. Another workaround is the use of vibration-dampening mount, which can be a hassle compared to other GoPros. Some users have reported that using intense low pass filtering of the gyro data (e.g. cutoff of 4 Hz or less) can yield acceptable results for some drone footage. This cannot correct for e.g. higher frequency propwash oscillations or vibrations, but can smooth out the general movement. The Hero 7 doesn't compute per-frame orientations, meaning synchronization is required. For handheld footage, the mentioned noise issues shouldn't be a problem. Furthermore, footage from the Hero 7 with Hypersmooth enabled does not work with Gyroflow.","title":"Hero 7"},{"location":"cams/gopro/#hero-6","text":"The Hero 6 contains gyroscope and accelerometer data, and can thus be used with Gyroflow out of the box. Due to the lack of per-frame orientations, the synchronization step is still required. The Hero 6 doesn't exhibit the noise issues of the Hero 7, and works well for drone footage. Compared to Hero 8/9/10, no internal rolling shutter processing is performed, meaning fast motion can cause warping, if no rolling shutter correction is applied in Gyroflow.","title":"Hero 6"},{"location":"cams/gopro/#hero-5session-5","text":"The Hero 5 exhibits similar vibration-induced noise problems to the Hero 7, and is thus not recommended for drone footage out of the box. Once again, users have reported achieving acceptable stabilization using intense low pass filtering, so if you already have this camera, that's worth a try. Just like the Hero 7, handheld footage doesn't yield any major problems.","title":"Hero 5/Session 5"},{"location":"cams/insta360/","text":"Action cameras from Insta360 (OneR, SMO 4k, Go, GO2) support gyro logging for use with the Flowstate stabilization option. This metadata also works with Gyroflow. Once again, try recording at the widest possible field of view. e.g. the Pro Video on the Go 2 saves the full sensor frame.","title":"Insta360"},{"location":"cams/mobius/","text":"Mobius Maxi 4K With the latest available firmware, this camera logs gyro data using the .gcsv format and can be used with Gyroflow.","title":"Mobius"},{"location":"cams/mobius/#mobius-maxi-4k","text":"With the latest available firmware, this camera logs gyro data using the .gcsv format and can be used with Gyroflow.","title":"Mobius Maxi 4K"},{"location":"cams/red/","text":"Warning While most RED cameras have the required hardware for gyro logging, not all of them have this feature enabled yet. Some cameras from RED cinema save motion data, either on a per-frame basis, or asynchronously (faster sample rate). This data is supported by Gyroflow in the development builds Footage from the following cameras are known to contain per-frame motion data: RED RAVEN ??? Footage from the following cameras contain asynchronous motion data: RED V-RAPTOR ?? View RED metadata manually If you wish to view the RED metadata without using Gyroflow, you can use REDline, a command-line utility bundled with REDCINE-X PRO ( Windows , MacOS ) or standalone program ( Linux ). See how to install and launch REDline based on your operating system in this guide . In order to view the per-frame metadata for a video file, run: REDline --i video.R3D --printMeta 5 Assuming REDline is in the PATH, or e.g. \"C:\\Program Files\\REDCINE-X PRO 64-bit\\REDline\" --i video.R3D --printMeta 5 on a Windows installation of REDCINE-X PRO. For a clip from a RED RAVEN, this yields: FrameNo,Timecode,Timestamp,Aperture,Focus Distance,Focal Length,Acceleration X,Acceleration Y,Acceleration Z,Rotation X,Rotation Y,Rotation Z,Cooke Metadata 0,20:47:06:03,,4.500000,455,10,0.087000,-0.019000,1.022000,0.189000,-0.001000,-2.253000, 1,20:47:06:04,,4.500000,455,10,0.102000,-0.019000,1.007000,2.438000,-2.250000,-4.502000, 2,20:47:06:05,,4.500000,455,10,0.102000,-0.019000,1.022000,2.438000,-0.001000,-2.253000, 3,20:47:06:06,,4.500000,455,10,0.102000,-0.019000,1.007000,2.446000,-0.001000,-4.502000, 4,20:47:06:07,,4.500000,455,10,0.087000,-0.003000,1.007000,2.446000,0.007000,-4.502000, 5,20:47:06:08,,4.500000,455,10,0.087000,-0.019000,1.007000,2.446000,0.007000,-2.253000, 6,20:47:06:09,,4.500000,455,10,0.087000,-0.019000,1.007000,2.438000,-0.001000,-0.004000, 7,20:47:06:10,,4.500000,455,10,0.102000,-0.019000,1.007000,2.438000,-0.001000,-0.004000, 8,20:47:06:11,,4.500000,455,10,0.102000,-0.019000,0.991000,2.438000,-0.001000,-0.004000, ... In order to view the asynchronous metadata, run: REDline --i video.R3D --printMeta 7 This yields the following for a clip without this data: [02-07-22-24-33-066]<69f4> Clip does not have async IMU data","title":"RED Cinema"},{"location":"cams/red/#view-red-metadata-manually","text":"If you wish to view the RED metadata without using Gyroflow, you can use REDline, a command-line utility bundled with REDCINE-X PRO ( Windows , MacOS ) or standalone program ( Linux ). See how to install and launch REDline based on your operating system in this guide . In order to view the per-frame metadata for a video file, run: REDline --i video.R3D --printMeta 5 Assuming REDline is in the PATH, or e.g. \"C:\\Program Files\\REDCINE-X PRO 64-bit\\REDline\" --i video.R3D --printMeta 5 on a Windows installation of REDCINE-X PRO. For a clip from a RED RAVEN, this yields: FrameNo,Timecode,Timestamp,Aperture,Focus Distance,Focal Length,Acceleration X,Acceleration Y,Acceleration Z,Rotation X,Rotation Y,Rotation Z,Cooke Metadata 0,20:47:06:03,,4.500000,455,10,0.087000,-0.019000,1.022000,0.189000,-0.001000,-2.253000, 1,20:47:06:04,,4.500000,455,10,0.102000,-0.019000,1.007000,2.438000,-2.250000,-4.502000, 2,20:47:06:05,,4.500000,455,10,0.102000,-0.019000,1.022000,2.438000,-0.001000,-2.253000, 3,20:47:06:06,,4.500000,455,10,0.102000,-0.019000,1.007000,2.446000,-0.001000,-4.502000, 4,20:47:06:07,,4.500000,455,10,0.087000,-0.003000,1.007000,2.446000,0.007000,-4.502000, 5,20:47:06:08,,4.500000,455,10,0.087000,-0.019000,1.007000,2.446000,0.007000,-2.253000, 6,20:47:06:09,,4.500000,455,10,0.087000,-0.019000,1.007000,2.438000,-0.001000,-0.004000, 7,20:47:06:10,,4.500000,455,10,0.102000,-0.019000,1.007000,2.438000,-0.001000,-0.004000, 8,20:47:06:11,,4.500000,455,10,0.102000,-0.019000,0.991000,2.438000,-0.001000,-0.004000, ... In order to view the asynchronous metadata, run: REDline --i video.R3D --printMeta 7 This yields the following for a clip without this data: [02-07-22-24-33-066]<69f4> Clip does not have async IMU data","title":"View RED metadata manually"},{"location":"cams/runcam/","text":"The gyros in both the runcam 5 Orange and gocam PM GR can be sensitive to strong vibrations. You should therefore not rigidly mount it to a source of vibrations (e.g. Drone), but instead use either a TPU mount or similar. The runcam 5 seems to tolerate vibrations decently well, so standard TPU or foam mounts should suffice. From limited testing, the gocam may be more sensitive to motor noise, so see if you can find or 3D print something for better vibration isolation. Runcam 5 Orange Surprise! All along the Runcam 5 Orange had an IMU hidden inside. This was of course previously used for the EIS, but with the newest versions of the firmware, the gyro and accelerometer data can be logged to a CSV file along with the video for post stabilization with Gyroflow. Find the firmware here: https://www.runcam.com/download/runcam5or The following have been found to be decent settings for the Runcam 5 Orange, with * indicating it's important for Gyroflow stabilization. Video quality: High Resolution*: Either 4K@30FPS(XV) or 1440p@60fps. The XV resolution is actually the full 4:3 sensor stretched to a 16:9 image. So this gives the highest resolution and FOV. Note that the stretching looks bad, so if used without additional processing, linearly squeeze the width to 75% in the video editor to get a 4:3 image. The 1440p option is natively 4:3, so if you want 60fps use this one. You can also use one of the 16:9 resolutions, but this significantly reduces the available FOV for stabilization. Volume: You decide Shutter*: Try to get a 90 to 180 degree shutter. So from 1/60 to 1/120 for 30fps and about 1/120 to 1/240 for 60 fps footage. (ND filter may be needed) ISO: As low as possible. There seems to be some auto gain regardless of settings. Color style: Normal (Flat squeezes the range and doesn\u2019t actually provide more dynamic range) Distortion correction*: Disabled Electronic Image Stabilization*: Disabled General settings (there were just found to work decently decently well, but do some testing yourself) Saturation: Medium Exposure compensation: 0 Contrast: Low Sharpness: Low Metering: Average White balance: Sunny (change depending on scenario, don\u2019t use auto) Low light enhancement: you decide. File processing Note This was required for the initial gyro logging firmware, and may not be applicable with the latest firmware. With the initial gyro logging firmware for the Runcam 5, it had an issue with occasionally generating a duplicate frame, which leads to jitter in the stabilized output. This could be fixed by the time you read this, but otherwise there\u2019s a way to solve it. FFmpeg has a command which can detect and remove duplicate frames. I will assume you already have FFmpeg available in the command line, if not, install it from ffmpeg.org . Duplicate frame detection: Run: ffmpeg -i INPUTVIDEOFILE.mp4 -vf mpdecimate=hi=64:lo=32:frac=0.1 -loglevel debug -f null - After a few seconds, you'll see this: Typically there\u2019s a duplicate frame every 30 seconds. If the input and output frames are the same, then it isn\u2019t an issue. If they are different, we need to get rid of the duplicate frames using the following command: ffmpeg -i RC_0001_210724181232.MP4 -vf mpdecimate=hi=64:lo=32:frac=0.1,setpts=N/FRAME_RATE/TB -c:v libx264 -crf 18 RC_0001_filtered.mp4 (replace with your filenames). Lower value for -crf means less compression If using an nvidia GPU (faster processing): ffmpeg -i RC_0001_210724181232.MP4 -vf mpdecimate=hi=64:lo=32:frac=0.1,setpts=N/FRAME_RATE/TB -c:v h264_nvenc -b:v 50M RC_0001_filtered.MP4 The 50M means encoding at 50 Mbps, change if needed. Replacing h264_nvenc with h264_amf should work for AMD systems In Gyroflow If using 4K XV, use the preset: RunCam/Runcam_5_Orange_4K_30FPS_XV_16by9_stretched.json If using 1440p 60fps use: RunCam/Runcam_5_Orange_1440p_4by3.json Low pass filter at about 60 Hz should be fine Note : Gyroflow v1.0.0-rc1 does not yet support the 4K XV option right away (will be added shortly). Use adjust parameters and change the first Pixel focal length value from 1503.650975788249 to 2004.868 : GOCam PM GR Depending on your setup, you might need to softmount this cam, since the the gyro can be sensitive to motor noise vibrations. Settings First of all, download the latest firmware. With the initial firmware, the only 4:3 resolution is 1440p 60fps. If you want the full sensor use that. Otherwise use the 4K resolution (works fine if you end up cropping to a cinematic aspect ratio) In Gyroflow Use either the RunCam/Runcam_Iflight_Gocam_1440p_4by3.json preset or the RunCam/Runcam_Iflight_Gocam_PMGR_4K_16by9.json preset depending on setting A 50 Hz low pass filter setting is a good starting point.","title":"Runcam"},{"location":"cams/runcam/#runcam-5-orange","text":"Surprise! All along the Runcam 5 Orange had an IMU hidden inside. This was of course previously used for the EIS, but with the newest versions of the firmware, the gyro and accelerometer data can be logged to a CSV file along with the video for post stabilization with Gyroflow. Find the firmware here: https://www.runcam.com/download/runcam5or The following have been found to be decent settings for the Runcam 5 Orange, with * indicating it's important for Gyroflow stabilization. Video quality: High Resolution*: Either 4K@30FPS(XV) or 1440p@60fps. The XV resolution is actually the full 4:3 sensor stretched to a 16:9 image. So this gives the highest resolution and FOV. Note that the stretching looks bad, so if used without additional processing, linearly squeeze the width to 75% in the video editor to get a 4:3 image. The 1440p option is natively 4:3, so if you want 60fps use this one. You can also use one of the 16:9 resolutions, but this significantly reduces the available FOV for stabilization. Volume: You decide Shutter*: Try to get a 90 to 180 degree shutter. So from 1/60 to 1/120 for 30fps and about 1/120 to 1/240 for 60 fps footage. (ND filter may be needed) ISO: As low as possible. There seems to be some auto gain regardless of settings. Color style: Normal (Flat squeezes the range and doesn\u2019t actually provide more dynamic range) Distortion correction*: Disabled Electronic Image Stabilization*: Disabled General settings (there were just found to work decently decently well, but do some testing yourself) Saturation: Medium Exposure compensation: 0 Contrast: Low Sharpness: Low Metering: Average White balance: Sunny (change depending on scenario, don\u2019t use auto) Low light enhancement: you decide.","title":"Runcam 5 Orange"},{"location":"cams/runcam/#file-processing","text":"Note This was required for the initial gyro logging firmware, and may not be applicable with the latest firmware. With the initial gyro logging firmware for the Runcam 5, it had an issue with occasionally generating a duplicate frame, which leads to jitter in the stabilized output. This could be fixed by the time you read this, but otherwise there\u2019s a way to solve it. FFmpeg has a command which can detect and remove duplicate frames. I will assume you already have FFmpeg available in the command line, if not, install it from ffmpeg.org . Duplicate frame detection: Run: ffmpeg -i INPUTVIDEOFILE.mp4 -vf mpdecimate=hi=64:lo=32:frac=0.1 -loglevel debug -f null - After a few seconds, you'll see this: Typically there\u2019s a duplicate frame every 30 seconds. If the input and output frames are the same, then it isn\u2019t an issue. If they are different, we need to get rid of the duplicate frames using the following command: ffmpeg -i RC_0001_210724181232.MP4 -vf mpdecimate=hi=64:lo=32:frac=0.1,setpts=N/FRAME_RATE/TB -c:v libx264 -crf 18 RC_0001_filtered.mp4 (replace with your filenames). Lower value for -crf means less compression If using an nvidia GPU (faster processing): ffmpeg -i RC_0001_210724181232.MP4 -vf mpdecimate=hi=64:lo=32:frac=0.1,setpts=N/FRAME_RATE/TB -c:v h264_nvenc -b:v 50M RC_0001_filtered.MP4 The 50M means encoding at 50 Mbps, change if needed. Replacing h264_nvenc with h264_amf should work for AMD systems In Gyroflow If using 4K XV, use the preset: RunCam/Runcam_5_Orange_4K_30FPS_XV_16by9_stretched.json If using 1440p 60fps use: RunCam/Runcam_5_Orange_1440p_4by3.json Low pass filter at about 60 Hz should be fine Note : Gyroflow v1.0.0-rc1 does not yet support the 4K XV option right away (will be added shortly). Use adjust parameters and change the first Pixel focal length value from 1503.650975788249 to 2004.868 :","title":"File processing"},{"location":"cams/runcam/#gocam-pm-gr","text":"Depending on your setup, you might need to softmount this cam, since the the gyro can be sensitive to motor noise vibrations.","title":"GOCam PM GR"},{"location":"cams/runcam/#settings","text":"First of all, download the latest firmware. With the initial firmware, the only 4:3 resolution is 1440p 60fps. If you want the full sensor use that. Otherwise use the 4K resolution (works fine if you end up cropping to a cinematic aspect ratio)","title":"Settings"},{"location":"cams/runcam/#in-gyroflow","text":"Use either the RunCam/Runcam_Iflight_Gocam_1440p_4by3.json preset or the RunCam/Runcam_Iflight_Gocam_PMGR_4K_16by9.json preset depending on setting A 50 Hz low pass filter setting is a good starting point.","title":"In Gyroflow"},{"location":"cams/smartphones/","text":"Smartphones contains IMU's and allow for gyro logging. IOS apps GyroCam - Professional Camera is a camera app with gyro logging support designed to be compatible with Gyroflow. The following are motion data logging apps which can be used with Gyroflow: G-Field Recorder Gyro - Record Device Motion Data Sensor Logger Android apps The following are gyro data loggers for Android which can be used with Gyroflow: Sensor Logger Sensor Record","title":"Smartphones"},{"location":"cams/smartphones/#ios-apps","text":"GyroCam - Professional Camera is a camera app with gyro logging support designed to be compatible with Gyroflow. The following are motion data logging apps which can be used with Gyroflow: G-Field Recorder Gyro - Record Device Motion Data Sensor Logger","title":"IOS apps"},{"location":"cams/smartphones/#android-apps","text":"The following are gyro data loggers for Android which can be used with Gyroflow: Sensor Logger Sensor Record","title":"Android apps"},{"location":"cams/sony/","text":"The following cameras are capable of native gyro data logging: a1, a7c, a7r IV, a7 IV, a7s III, a9 II, FX3, FX6, RX0 II, RX100 VII, ZV1, ZV-E10 This data is designed for use with Sony's Catalyst Browse stabilization which cannot stabilize footage shot with third-party lenses. Gyroflow supports reading this metadata natively, thus giving access to more smoothing algorithms and support for third-party lenses. General It has been found that the above mentioned Sony cameras do not record motion data when capturing at 120 fps . Sony a1/a7c/a7r IV/a7 IV/a7s III/a9 II Since these cameras contain mechanical in-body image stabilization, this should be disabled when using Gyroflow. Even disabled, the sensor may still shift around in the presence of vibrations or strong accelerations. This is unlikely to be an issue with hand-held footage, but your mileage may vary.","title":"Sony"},{"location":"cams/sony/#general","text":"It has been found that the above mentioned Sony cameras do not record motion data when capturing at 120 fps .","title":"General"},{"location":"cams/sony/#sony-a1a7ca7r-iva7-iva7s-iiia9-ii","text":"Since these cameras contain mechanical in-body image stabilization, this should be disabled when using Gyroflow. Even disabled, the sensor may still shift around in the presence of vibrations or strong accelerations. This is unlikely to be an issue with hand-held footage, but your mileage may vary.","title":"Sony a1/a7c/a7r IV/a7 IV/a7s III/a9 II"},{"location":"contrib/documentation/","text":"Help with documentation This site uses MkDocs and Material for MkDocs and is formatted with Markdown. Here's how to serve a local version for editing purposes Install MkDocs and Material for MkDocs: pip install mkdocs-material Clone the repo: git clone https://github.com/gyroflow/gyroflow-docs.git Run local server: mkdocs serve Alternatively each page has an edit button which directly opens the GitHub online editor. In general, create GitHub pull request to merge the edits. MkDocs/Markdown examples Note Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa. This is a warning Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa. Image with lightbox: Image title This is some text with a footnote 1 . Here's a LaTeX math block rendered using MathJax $$ c = \\sqrt{a^2 + b^2} $$ Here's a Python code block with line numbers 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # Generate 24 different (right handed) orientations using cross products def generate_rotmats (): basis = [[ 1 , 0 , 0 ], [ 0 , 1 , 0 ], [ 0 , 0 , 1 ], [ - 1 , 0 , 0 ], [ 0 , - 1 , 0 ], [ 0 , 0 , - 1 ]] # Six different unit vectors basis = [ np . array ( v ) for v in basis ] ORIENTATIONS = [] for i in range ( len ( basis )): for j in range ( len ( basis )): if i != j and ( i + 3 ) % 6 != j : ivec = basis [ i ] jvec = basis [ j ] kvec = np . cross ( ivec , jvec ) mat = np . vstack ([ ivec , jvec , kvec ]) . transpose () ORIENTATIONS . append ( mat ) Content of the footnote \u21a9","title":"Documentation"},{"location":"contrib/documentation/#help-with-documentation","text":"This site uses MkDocs and Material for MkDocs and is formatted with Markdown. Here's how to serve a local version for editing purposes Install MkDocs and Material for MkDocs: pip install mkdocs-material Clone the repo: git clone https://github.com/gyroflow/gyroflow-docs.git Run local server: mkdocs serve Alternatively each page has an edit button which directly opens the GitHub online editor. In general, create GitHub pull request to merge the edits.","title":"Help with documentation"},{"location":"contrib/documentation/#mkdocsmarkdown-examples","text":"Note Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa. This is a warning Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa. Image with lightbox: Image title This is some text with a footnote 1 . Here's a LaTeX math block rendered using MathJax $$ c = \\sqrt{a^2 + b^2} $$ Here's a Python code block with line numbers 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # Generate 24 different (right handed) orientations using cross products def generate_rotmats (): basis = [[ 1 , 0 , 0 ], [ 0 , 1 , 0 ], [ 0 , 0 , 1 ], [ - 1 , 0 , 0 ], [ 0 , - 1 , 0 ], [ 0 , 0 , - 1 ]] # Six different unit vectors basis = [ np . array ( v ) for v in basis ] ORIENTATIONS = [] for i in range ( len ( basis )): for j in range ( len ( basis )): if i != j and ( i + 3 ) % 6 != j : ivec = basis [ i ] jvec = basis [ j ] kvec = np . cross ( ivec , jvec ) mat = np . vstack ([ ivec , jvec , kvec ]) . transpose () ORIENTATIONS . append ( mat ) Content of the footnote \u21a9","title":"MkDocs/Markdown examples"},{"location":"contrib/flowshutter/","text":"","title":"Flowshutter"},{"location":"contrib/gyroflow/","text":"Contribute to Gyroflow For contributing to the main Gyroflow program, refer to the Github repository . Feature requests can be submitted by opening issues, and new features can be added through pull requests. Another way of contributing to the project is by helping translate the program to your language. This is done through crowdin : https://crowdin.com/project/gyroflow . Currently Gyroflow is available in: English (base language) Polish (by AdrianEddy ) German (by Grommi and Nicecrash ) Danish (by ElvinC ) Norwegian (by MiniGod and alexagv ) Chinese Simplified (by DusKing1 ) Chinese Traditional (by DusKing1 ) Furthermore, you can contribute to the Gyroflow project by creating and submitting new lens profiles. This allows future users with the same hardware to start using the software right away.","title":"Gyroflow"},{"location":"contrib/gyroflow/#contribute-to-gyroflow","text":"For contributing to the main Gyroflow program, refer to the Github repository . Feature requests can be submitted by opening issues, and new features can be added through pull requests. Another way of contributing to the project is by helping translate the program to your language. This is done through crowdin : https://crowdin.com/project/gyroflow . Currently Gyroflow is available in: English (base language) Polish (by AdrianEddy ) German (by Grommi and Nicecrash ) Danish (by ElvinC ) Norwegian (by MiniGod and alexagv ) Chinese Simplified (by DusKing1 ) Chinese Traditional (by DusKing1 ) Furthermore, you can contribute to the Gyroflow project by creating and submitting new lens profiles. This allows future users with the same hardware to start using the software right away.","title":"Contribute to Gyroflow"},{"location":"contrib/support/","text":"The Gyroflow project was initially a Python program started by Elvin in 2020. Elvin is currently one of the developers working on software and hardware development: Support Elvin via Patreon Version 1.0 and onwards was made possible by AdrianEddy, who worked overtime on adapting the previous Python codebase to high-performance cross-platform Rust code with a modern UI, and implemented new advanced features like rolling shutter correction. You can find AdrianEddy on Github: AdrianEddy Other contributors Other amazing contributors have helped during the development by discussing, testing, and implementing new ideas for video stabilization, both for the previous Python version and the current software. Some of these people are: Aphobius - Author of velocity dampened smoothing algorithm Marc Roeschlin - Author of adaptive zoom algorithm alexagv - Investigated advanced rendering options for the Python version nivim - Work on insta360 support for the Python version MiniGod - Investigated sync-less GoPro stabilization Gro2mi - Work on automatic lens calibration and sync for the Python version DusKing1 - Hardware development and translations for Gyroflow NiceCrash - Started a community around FPV video stabilization and has been an alpha/beta tester with involvement from the very beginning of the project Finally, a huge thanks goes out to everyone who provided sample footage during the development. This has made it possible to natively support a wide range of cameras and gyro sources. Fun fact: Elvin did not own a suitable camera for testing in the initial months of the project, so Gyroflow would literally not have been made without everyone's willingness to help.","title":"Support Gyroflow / Contributors list"},{"location":"contrib/support/#other-contributors","text":"Other amazing contributors have helped during the development by discussing, testing, and implementing new ideas for video stabilization, both for the previous Python version and the current software. Some of these people are: Aphobius - Author of velocity dampened smoothing algorithm Marc Roeschlin - Author of adaptive zoom algorithm alexagv - Investigated advanced rendering options for the Python version nivim - Work on insta360 support for the Python version MiniGod - Investigated sync-less GoPro stabilization Gro2mi - Work on automatic lens calibration and sync for the Python version DusKing1 - Hardware development and translations for Gyroflow NiceCrash - Started a community around FPV video stabilization and has been an alpha/beta tester with involvement from the very beginning of the project Finally, a huge thanks goes out to everyone who provided sample footage during the development. This has made it possible to natively support a wide range of cameras and gyro sources. Fun fact: Elvin did not own a suitable camera for testing in the initial months of the project, so Gyroflow would literally not have been made without everyone's willingness to help.","title":"Other contributors"},{"location":"flowshutter/clist/","text":"Welcome to the Camera List. To navigate through this section, use the sidebar on the right . At the time of writing, the lists below are not complete and needs further updating. If you know of a certain camera's way of REC triggering, please let us know via: Flowshutter issue Gyroflow Discord Sony Multi-Terminal Protocol It seems that any camera from Sony that has this Multi-USB port can use this protocol for REC triggering. How to make Sony Multi USB connector? Wiring? Camera Support info Camera Support info Camera Support info A5000 yes A7S yes A7R yes A5100 yes A7S2 yes A7R2 yes A6000 yes A7S3 yes A7R3 yes A6100 yes A7M yes A7R4 yes A6300 yes A7M2 yes FX3 yes A6400 yes A7M3 yes FX6 yes A6500 yes A7M4 yes FX9 yes A6600 yes A7C no FS5 yes Momentary Ground As the name implies, momentarily shorting a pin in one of the camera's port(s) to ground triggers REC start/stop. Many cameras support triggering REC using this method. Wiring Diagrams Brand Model Support info Notes Blackmagic Design Pocket Cinema Camera 4k yes w/ ZITAY recording cable Blackmagic Design Pocket Cinema Camera 6k yes w/ ZITAY recording cable Blackmagic Design Pocket Cinema Camera 6k pro yes w/ ZITAY recording cable Kinefinity MAVO LF 6k yes Kinefinity MAVO Edge 6K yes Kinefinity MAVO Edge 8K yes RED DSMC2 yes RED RANGER yes Panasonic Lumix DMC-GH1 yes w/ Panasonic Custom Trigger Connector Panasonic Lumix DMC-GH2 yes w/ Panasonic Custom Trigger Connector Panasonic Lumix DMC-GH3 yes w/ Panasonic Custom Trigger Connector Panasonic Lumix DMC-GH4 yes w/ Panasonic Custom Trigger Connector Panasonic Lumix DMC-GH5 yes w/ Panasonic Custom Trigger Connector Panasonic Lumix DC-GH5S yes w/ Panasonic Custom Trigger Connector More.. To Be Appended 3.3V Schmitt Trigger Pull a pin of a port to 3.3V level to start REC, and pull it back to 0V to stop REC. Brand Model Support info RED DSMC yes RED DSMC2 yes ZCAM UART protocol All ZCAM cameras are theoretically supported, but have only been verified on the E2 series. Model Support info Note Model Support info Note E2 yes E2-S6 yes E2C no E2-F6 yes E2G yes E2-F8 yes E2-M4 yes E2-S6G yes TODO","title":"Supported Camera"},{"location":"flowshutter/clist/#sony-multi-terminal-protocol","text":"It seems that any camera from Sony that has this Multi-USB port can use this protocol for REC triggering. How to make Sony Multi USB connector? Wiring? Camera Support info Camera Support info Camera Support info A5000 yes A7S yes A7R yes A5100 yes A7S2 yes A7R2 yes A6000 yes A7S3 yes A7R3 yes A6100 yes A7M yes A7R4 yes A6300 yes A7M2 yes FX3 yes A6400 yes A7M3 yes FX6 yes A6500 yes A7M4 yes FX9 yes A6600 yes A7C no FS5 yes","title":"Sony Multi-Terminal Protocol"},{"location":"flowshutter/clist/#momentary-ground","text":"As the name implies, momentarily shorting a pin in one of the camera's port(s) to ground triggers REC start/stop. Many cameras support triggering REC using this method. Wiring Diagrams Brand Model Support info Notes Blackmagic Design Pocket Cinema Camera 4k yes w/ ZITAY recording cable Blackmagic Design Pocket Cinema Camera 6k yes w/ ZITAY recording cable Blackmagic Design Pocket Cinema Camera 6k pro yes w/ ZITAY recording cable Kinefinity MAVO LF 6k yes Kinefinity MAVO Edge 6K yes Kinefinity MAVO Edge 8K yes RED DSMC2 yes RED RANGER yes Panasonic Lumix DMC-GH1 yes w/ Panasonic Custom Trigger Connector Panasonic Lumix DMC-GH2 yes w/ Panasonic Custom Trigger Connector Panasonic Lumix DMC-GH3 yes w/ Panasonic Custom Trigger Connector Panasonic Lumix DMC-GH4 yes w/ Panasonic Custom Trigger Connector Panasonic Lumix DMC-GH5 yes w/ Panasonic Custom Trigger Connector Panasonic Lumix DC-GH5S yes w/ Panasonic Custom Trigger Connector More.. To Be Appended","title":"Momentary Ground"},{"location":"flowshutter/clist/#33v-schmitt-trigger","text":"Pull a pin of a port to 3.3V level to start REC, and pull it back to 0V to stop REC. Brand Model Support info RED DSMC yes RED DSMC2 yes","title":"3.3V Schmitt Trigger"},{"location":"flowshutter/clist/#zcam-uart-protocol","text":"All ZCAM cameras are theoretically supported, but have only been verified on the E2 series. Model Support info Note Model Support info Note E2 yes E2-S6 yes E2C no E2-F6 yes E2G yes E2-F8 yes E2-M4 yes E2-S6G yes","title":"ZCAM UART protocol"},{"location":"flowshutter/clist/#todo","text":"","title":"TODO"},{"location":"flowshutter/flowshutter/","text":"Flowshutter is a custom camera remote. When used in conjunction with readily available hardware, this results in a flexible and reliable external camera motion logger for Gyroflow. It can provide precise synchronization of camera video recording and motion logger (betaflight/emuflight FC) recording. It was designed to be used with the Gyroflow software to provide you one of the best open source video stabilization experiences. Features \"1-click\" - synchronously start/stop (1) FC arm (2) camera recording \"Audio injection\" - inject sync marker to the audio track for precise synchronization between video and gyro data OLED Display - show the device information and allow user to change settings without hacking the firmware code Blackbox Erasion - erase all blackbox data without connecting to the computer Supported Hardware NeutronRC has been continuously cooperating with us on commercial hardware development, and their commercial version of flowshutter is our first recommended choice. For more info about list of supported hardware, please check Supported Hardware . Compatible camera protocol/trigger mechanisms Sony Multi-Terminal Port USB Protocol Momentary Ground 3.3V Schmitt Trigger ZCAM UART protocol Sony LANC protocol* (WIP) 5V Schmitt Trigger (WIP) HDMI CEC protocol Check out our list of Supported Camera for more details. Note Sony LANC protocol need an extra LANC controller, an Arduino example code is available here . Compatible FC Flowbox (highly recommended) Modern FC with BMI270 gyro (recommended) Any other FC that support CRSF protocol More info Source code: https://github.com/gyroflow/flowshutter Development Guide: https://github.com/gyroflow/flowshutter#development-guide","title":"Overview"},{"location":"flowshutter/flowshutter/#features","text":"\"1-click\" - synchronously start/stop (1) FC arm (2) camera recording \"Audio injection\" - inject sync marker to the audio track for precise synchronization between video and gyro data OLED Display - show the device information and allow user to change settings without hacking the firmware code Blackbox Erasion - erase all blackbox data without connecting to the computer","title":"Features"},{"location":"flowshutter/flowshutter/#supported-hardware","text":"NeutronRC has been continuously cooperating with us on commercial hardware development, and their commercial version of flowshutter is our first recommended choice. For more info about list of supported hardware, please check Supported Hardware .","title":"Supported Hardware"},{"location":"flowshutter/flowshutter/#compatible-camera-protocoltrigger-mechanisms","text":"Sony Multi-Terminal Port USB Protocol Momentary Ground 3.3V Schmitt Trigger ZCAM UART protocol Sony LANC protocol* (WIP) 5V Schmitt Trigger (WIP) HDMI CEC protocol Check out our list of Supported Camera for more details. Note Sony LANC protocol need an extra LANC controller, an Arduino example code is available here .","title":"Compatible camera protocol/trigger mechanisms"},{"location":"flowshutter/flowshutter/#compatible-fc","text":"Flowbox (highly recommended) Modern FC with BMI270 gyro (recommended) Any other FC that support CRSF protocol","title":"Compatible FC"},{"location":"flowshutter/flowshutter/#more-info","text":"Source code: https://github.com/gyroflow/flowshutter Development Guide: https://github.com/gyroflow/flowshutter#development-guide","title":"More info"},{"location":"flowshutter/hardware/","text":"List for Supported Hardwares Welcome to the Hardware List. To navigate through this section, use the sidebar on the right . This page shows infomation on certain hardware that is supported by flowshutter. More and more manufacturers are adding support for new hardware and new feature based on that, so this list is not exhaustive and keeps growing. NeutronRC SDB NeutronRC Stabilization Data Box General Overview Specification Bone-like shape, 43 x 18 x 10mm Nylon sintered case with acrylic panel Adjustable cold shoe mounts (for different mounting postions and/or orentations) Built-in 600mah battery (enough for 5 hours of working) Built-in power switch Built-in battery charger and indicator Built-in single track MEMS microphone Dual layer design with flowbox built-in (F411 + BMI270 + 128MB blackbox) Separate USB-C's of flight controller and flowshutter Dual 3.5mm jack for camera controlling and audio injection Links Taobao (\u6dd8\u5b9d) AliExpress NewBeeDrone will be one of the resellers of this product soon! DIY (FC Sized) This scheme was designed by us to take advantage of the old 30x30 size flight controller. General Overview Specification FC shape, holes 30.5 x 30.5mm, size 38 x 40 mm Bare PCB 2-6s input voltage range (7.4V to 22.2V) Dual buttons for each button IO Solder pads for camera controlling and audio injection IOs Easy to DIY Links FC size : build video is here DIY (Credit Card Sized) General Overview Specification Credit card shape, holes 47.6 x 28.3 mm, shape 50 x 32 mm 18650 battery case support On-board power switch On-board battery charger and indicator Solder pads for camera controlling and audio injection IOs Easy to DIY Links Credit card size : build video is here","title":"Supported Hardware"},{"location":"flowshutter/hardware/#list-for-supported-hardwares","text":"Welcome to the Hardware List. To navigate through this section, use the sidebar on the right . This page shows infomation on certain hardware that is supported by flowshutter. More and more manufacturers are adding support for new hardware and new feature based on that, so this list is not exhaustive and keeps growing.","title":"List for Supported Hardwares"},{"location":"flowshutter/hardware/#neutronrc-sdb","text":"NeutronRC Stabilization Data Box","title":"NeutronRC SDB"},{"location":"flowshutter/hardware/#general-overview","text":"","title":"General Overview"},{"location":"flowshutter/hardware/#specification","text":"Bone-like shape, 43 x 18 x 10mm Nylon sintered case with acrylic panel Adjustable cold shoe mounts (for different mounting postions and/or orentations) Built-in 600mah battery (enough for 5 hours of working) Built-in power switch Built-in battery charger and indicator Built-in single track MEMS microphone Dual layer design with flowbox built-in (F411 + BMI270 + 128MB blackbox) Separate USB-C's of flight controller and flowshutter Dual 3.5mm jack for camera controlling and audio injection","title":"Specification"},{"location":"flowshutter/hardware/#links","text":"Taobao (\u6dd8\u5b9d) AliExpress NewBeeDrone will be one of the resellers of this product soon!","title":"Links"},{"location":"flowshutter/hardware/#diy-fc-sized","text":"This scheme was designed by us to take advantage of the old 30x30 size flight controller.","title":"DIY (FC Sized)"},{"location":"flowshutter/hardware/#general-overview_1","text":"","title":"General Overview"},{"location":"flowshutter/hardware/#specification_1","text":"FC shape, holes 30.5 x 30.5mm, size 38 x 40 mm Bare PCB 2-6s input voltage range (7.4V to 22.2V) Dual buttons for each button IO Solder pads for camera controlling and audio injection IOs Easy to DIY","title":"Specification"},{"location":"flowshutter/hardware/#links_1","text":"FC size : build video is here","title":"Links"},{"location":"flowshutter/hardware/#diy-credit-card-sized","text":"","title":"DIY (Credit Card Sized)"},{"location":"flowshutter/hardware/#general-overview_2","text":"","title":"General Overview"},{"location":"flowshutter/hardware/#specification_2","text":"Credit card shape, holes 47.6 x 28.3 mm, shape 50 x 32 mm 18650 battery case support On-board power switch On-board battery charger and indicator Solder pads for camera controlling and audio injection IOs Easy to DIY","title":"Specification"},{"location":"flowshutter/hardware/#links_2","text":"Credit card size : build video is here","title":"Links"},{"location":"flowshutter/quickstart/","text":"Quick Start for Flowshutter This page assumes that you are using a commercial version of Flowshutter (depending on the manufacturer, it may be called differently, such as \"stabilization box\", \"stabilization data box\", \"flowshutter box\", etc), these commercial hardwares often contain a flowshutter board and a betaflight flight controller, as a whole. On this page we refer to these wholes as Flowshutter . If you are using a DIY flowshutter, then you should clearly separate your flight controller from the flowshutter, and carefully consider the specific configuration of the corresponding parts in this tutorial on your own build. Meet the hardware Although hardware from different manufacturers varies, their main components should be the same - necessary parts of the flowshutter device/firmware to work properly. At the time of writing this page, I only have the commercial version of NeutronRC hardware - NeutronRC SDB , so this page will give you a quick start based on that. OLED screen Flowshutter currently only support a single OLED screen, with 128x32 pixels. Buttons Flowshutter requires two physical buttons to complete the interaction, they are the PAGE button and the ENTER button Camera control port Flowshutter's control of the camera is achieved through the connection of physical wires to transmit control signals. So in order to be able to control your camera properly, you should use this port to properly connect with the camera's control interface. Flowshutter USB (Charge/ESP32 USB) This interface is used to upgrade the flowshutter firmware. Please note the difference between \"Flowshutter\" and \"flowshutter\", the former is a physical entity, and the latter refers specifically to the firmware. FC USB (Flowbox USB) This interface is use to configure the flight controller (motion data logger), and export motion data. Mount it to your camera Please mount Flowshutter rigidly to your camera. For use in high-vibration environments (such as a large X8 drone), be sure to take vibration reduction measures for the camera as a whole. You may have concerns about the installation orientation, but it doesn't matter, we have many flexible ways to offset the impact of different installation orientations. The easiest way will be introduced in the next section. Config it for your camera Select camera protocol Select device mode Reboot device Config logger part Connecting FC to computer, open betaflight configurator and connect to FC (flowbox) Change orientation in Configuration tab, until the drone's movement matched up with your camera movement in Setup tab. Exatracting motion data Connecting FC to computer Activating MSC mode In configurator, Blackbox tab, click Activate MSC button. Copy motion data Then the FC will become a readable USB drive, and you can copy the motion data from it to your computer. Flash firmware For some special reason, it may be necessary to flash a new firmware in some cases, such as: The new firmware adds control support to your camera The new firmware has features you desperately need The new firmware fixes a bug you're currently experiencing The following will briefly introduce the steps of firmware upgrade for you in the simplest way. Flash flowshutter firmware Download uPyCraft IDE Download flowshutter firmware from GitHub release (Optional) Download and install CH340 driver for your computer Open uPyCraft IDE Connect Flowshutter USB to your computer uPyCraft IDE -> Tools -> BurnFirmware Configure burning parameters as below: Hit OK and wait until it finishes Flash FC firmware Download betaflight configurator from Betaflight configurator release Connect your FC (flowbox) to your computer Firmware Flasher tab -> STM32F411 -> 4.3 -> Load Firmware [Online] -> Flash Firmware Add gyroflow logger-presets as third party preset source. Check this page and/or this page for more information. Connect to FC -> Presets tab -> pick and apply the cooresponding gyroflow preset for your device, e.g. NeutronRC SDB should pick NeutronRC SDB preset.","title":"Quick Start"},{"location":"flowshutter/quickstart/#quick-start-for-flowshutter","text":"This page assumes that you are using a commercial version of Flowshutter (depending on the manufacturer, it may be called differently, such as \"stabilization box\", \"stabilization data box\", \"flowshutter box\", etc), these commercial hardwares often contain a flowshutter board and a betaflight flight controller, as a whole. On this page we refer to these wholes as Flowshutter . If you are using a DIY flowshutter, then you should clearly separate your flight controller from the flowshutter, and carefully consider the specific configuration of the corresponding parts in this tutorial on your own build.","title":"Quick Start for Flowshutter"},{"location":"flowshutter/quickstart/#meet-the-hardware","text":"Although hardware from different manufacturers varies, their main components should be the same - necessary parts of the flowshutter device/firmware to work properly. At the time of writing this page, I only have the commercial version of NeutronRC hardware - NeutronRC SDB , so this page will give you a quick start based on that.","title":"Meet the hardware"},{"location":"flowshutter/quickstart/#oled-screen","text":"Flowshutter currently only support a single OLED screen, with 128x32 pixels.","title":"OLED screen"},{"location":"flowshutter/quickstart/#buttons","text":"Flowshutter requires two physical buttons to complete the interaction, they are the PAGE button and the ENTER button","title":"Buttons"},{"location":"flowshutter/quickstart/#camera-control-port","text":"Flowshutter's control of the camera is achieved through the connection of physical wires to transmit control signals. So in order to be able to control your camera properly, you should use this port to properly connect with the camera's control interface.","title":"Camera control port"},{"location":"flowshutter/quickstart/#flowshutter-usb-chargeesp32-usb","text":"This interface is used to upgrade the flowshutter firmware. Please note the difference between \"Flowshutter\" and \"flowshutter\", the former is a physical entity, and the latter refers specifically to the firmware.","title":"Flowshutter USB (Charge/ESP32 USB)"},{"location":"flowshutter/quickstart/#fc-usb-flowbox-usb","text":"This interface is use to configure the flight controller (motion data logger), and export motion data.","title":"FC USB (Flowbox USB)"},{"location":"flowshutter/quickstart/#mount-it-to-your-camera","text":"Please mount Flowshutter rigidly to your camera. For use in high-vibration environments (such as a large X8 drone), be sure to take vibration reduction measures for the camera as a whole. You may have concerns about the installation orientation, but it doesn't matter, we have many flexible ways to offset the impact of different installation orientations. The easiest way will be introduced in the next section.","title":"Mount it to your camera"},{"location":"flowshutter/quickstart/#config-it-for-your-camera","text":"","title":"Config it for your camera"},{"location":"flowshutter/quickstart/#select-camera-protocol","text":"","title":"Select camera protocol"},{"location":"flowshutter/quickstart/#select-device-mode","text":"","title":"Select device mode"},{"location":"flowshutter/quickstart/#reboot-device","text":"","title":"Reboot device"},{"location":"flowshutter/quickstart/#config-logger-part","text":"Connecting FC to computer, open betaflight configurator and connect to FC (flowbox) Change orientation in Configuration tab, until the drone's movement matched up with your camera movement in Setup tab.","title":"Config logger part"},{"location":"flowshutter/quickstart/#exatracting-motion-data","text":"","title":"Exatracting motion data"},{"location":"flowshutter/quickstart/#connecting-fc-to-computer","text":"","title":"Connecting FC to computer"},{"location":"flowshutter/quickstart/#activating-msc-mode","text":"In configurator, Blackbox tab, click Activate MSC button.","title":"Activating MSC mode"},{"location":"flowshutter/quickstart/#copy-motion-data","text":"Then the FC will become a readable USB drive, and you can copy the motion data from it to your computer.","title":"Copy motion data"},{"location":"flowshutter/quickstart/#flash-firmware","text":"For some special reason, it may be necessary to flash a new firmware in some cases, such as: The new firmware adds control support to your camera The new firmware has features you desperately need The new firmware fixes a bug you're currently experiencing The following will briefly introduce the steps of firmware upgrade for you in the simplest way.","title":"Flash firmware"},{"location":"flowshutter/quickstart/#flash-flowshutter-firmware","text":"Download uPyCraft IDE Download flowshutter firmware from GitHub release (Optional) Download and install CH340 driver for your computer Open uPyCraft IDE Connect Flowshutter USB to your computer uPyCraft IDE -> Tools -> BurnFirmware Configure burning parameters as below: Hit OK and wait until it finishes","title":"Flash flowshutter firmware"},{"location":"flowshutter/quickstart/#flash-fc-firmware","text":"Download betaflight configurator from Betaflight configurator release Connect your FC (flowbox) to your computer Firmware Flasher tab -> STM32F411 -> 4.3 -> Load Firmware [Online] -> Flash Firmware Add gyroflow logger-presets as third party preset source. Check this page and/or this page for more information. Connect to FC -> Presets tab -> pick and apply the cooresponding gyroflow preset for your device, e.g. NeutronRC SDB should pick NeutronRC SDB preset.","title":"Flash FC firmware"},{"location":"flowshutter/settings/","text":"Flowshutter has many settings to allow you to use it in different situations. This page contains a short description and guide to each of the settings. Luckily, many of the settings are self-explanatory. User Interaction System There are two or three buttons on the flowshutter: two buttons: Page Down and Enter three buttons: Page Up , Enter and Page Down To use them, you need to press, hold and release, which will trigger the short/long press event depending on the hold time. The threshold for short/long press is 500ms, longer than 50ms and shorter than 500ms will trigger a short press event, and longer than 500ms will trigger a long press event. Reboot menu On homepage, long press the Enter button and it will show the reboot menu. Page * : toggle between different reboot options Enter: : react to that option And the reboot options are: Exit : exit the reboot menu Reboot : reboot the device Battery info On home page, short press the Page * button and it will show the battery info. You can short press the Page * button to leave the battery info and back to homepage Device menu On homepage, long press the Page * button and it will show the device menu. Page * : switch the submenu Enter : enter the submenu In each submenu, we have three options: Leave : leave the submenu and back to overview state Save : save the settings to the device A setting: that can be changed to enable/disable the feature you can short press the Page * button to switch the option, and short press Enter to apply/into that option. When hovering over a specific setting, you can also short press Enter to enter/exit alignment changes, and use Page * to toggle options while making changes. You can then long press Page * in the overview state of any submenu to return to the homepage. Camera protocol Used to specify how the flowshutter interacts with the camera. NO : NO interact with the camera MMTRY GND : Momentary Ground on GPIO 25 (TX2) 3V3 Schmitt : 3.3V Schmitt Trigger on GPIO 26 (RX2) Sony MTP : Sony Multi-Terminal Port USB Protocol on UART2 ZCAM : ZCAM UART protocol on UART2 When you change the camera protocol, please restart when you receive the restart prompt on the OLED to ensure that the relevant hardware devices are properly applied / the microcontroller is properly initialized. Warning Do not use the wrong camera protocol on devices that do not match. Otherwise, there may be a crash/port burnout/equipment loss of warranty or even fire! Other protocols/mechenisms are under development. Device mode Used to specify how the flowshutter works with the camera. SLAVE : The flowshutter is a slave device. It can passively monitor the camera recording state and toggle FC ARM/DISARM correspondingly. MASTER : The flowshutter is a master device. It can actively trigger camera record/stop and FC ARM/DISARM. MASTER/SLAVE : The flowshutter is a master/slave device. It can actively trigger camera record/stop and FC ARM/DISARM, or it can passively monitor the camera recording status to trigger FC ARM/DISARM. Injection mode Used to specify whether flowshutter injects sync markers on the camera's audio track. This is so called \"Audio Injection\" feature. ON : Inject 25Hz sync marker on one of the audio track. OFF \uff1aNo sync marker injection. Blackbox erase Used to erase the blackbox data of the flowshutter. Erase stop : Stop the erase process. Erasing... : Start the erase process. Once you hear a two short beep from the FC, it means the erase process is done. Warning The erasing process cannot be cancelled and the erased data cannot be retrieved!","title":"Settings Explanation"},{"location":"flowshutter/settings/#user-interaction-system","text":"There are two or three buttons on the flowshutter: two buttons: Page Down and Enter three buttons: Page Up , Enter and Page Down To use them, you need to press, hold and release, which will trigger the short/long press event depending on the hold time. The threshold for short/long press is 500ms, longer than 50ms and shorter than 500ms will trigger a short press event, and longer than 500ms will trigger a long press event.","title":"User Interaction System"},{"location":"flowshutter/settings/#reboot-menu","text":"On homepage, long press the Enter button and it will show the reboot menu. Page * : toggle between different reboot options Enter: : react to that option And the reboot options are: Exit : exit the reboot menu Reboot : reboot the device","title":"Reboot menu"},{"location":"flowshutter/settings/#battery-info","text":"On home page, short press the Page * button and it will show the battery info. You can short press the Page * button to leave the battery info and back to homepage","title":"Battery info"},{"location":"flowshutter/settings/#device-menu","text":"On homepage, long press the Page * button and it will show the device menu. Page * : switch the submenu Enter : enter the submenu In each submenu, we have three options: Leave : leave the submenu and back to overview state Save : save the settings to the device A setting: that can be changed to enable/disable the feature you can short press the Page * button to switch the option, and short press Enter to apply/into that option. When hovering over a specific setting, you can also short press Enter to enter/exit alignment changes, and use Page * to toggle options while making changes. You can then long press Page * in the overview state of any submenu to return to the homepage.","title":"Device menu"},{"location":"flowshutter/settings/#camera-protocol","text":"Used to specify how the flowshutter interacts with the camera. NO : NO interact with the camera MMTRY GND : Momentary Ground on GPIO 25 (TX2) 3V3 Schmitt : 3.3V Schmitt Trigger on GPIO 26 (RX2) Sony MTP : Sony Multi-Terminal Port USB Protocol on UART2 ZCAM : ZCAM UART protocol on UART2 When you change the camera protocol, please restart when you receive the restart prompt on the OLED to ensure that the relevant hardware devices are properly applied / the microcontroller is properly initialized. Warning Do not use the wrong camera protocol on devices that do not match. Otherwise, there may be a crash/port burnout/equipment loss of warranty or even fire! Other protocols/mechenisms are under development.","title":"Camera protocol"},{"location":"flowshutter/settings/#device-mode","text":"Used to specify how the flowshutter works with the camera. SLAVE : The flowshutter is a slave device. It can passively monitor the camera recording state and toggle FC ARM/DISARM correspondingly. MASTER : The flowshutter is a master device. It can actively trigger camera record/stop and FC ARM/DISARM. MASTER/SLAVE : The flowshutter is a master/slave device. It can actively trigger camera record/stop and FC ARM/DISARM, or it can passively monitor the camera recording status to trigger FC ARM/DISARM.","title":"Device mode"},{"location":"flowshutter/settings/#injection-mode","text":"Used to specify whether flowshutter injects sync markers on the camera's audio track. This is so called \"Audio Injection\" feature. ON : Inject 25Hz sync marker on one of the audio track. OFF \uff1aNo sync marker injection.","title":"Injection mode"},{"location":"flowshutter/settings/#blackbox-erase","text":"Used to erase the blackbox data of the flowshutter. Erase stop : Stop the erase process. Erasing... : Start the erase process. Once you hear a two short beep from the FC, it means the erase process is done. Warning The erasing process cannot be cancelled and the erased data cannot be retrieved!","title":"Blackbox erase"},{"location":"flowshutter/wiring/","text":"Wiring to Camera This page shows you some common wiring methods and precautions to use with the Flowshutter. We are working on adding support for more are more camera protocol/triggering methods, so this list is not exhaustive and keeps growing. Sony Multi-USB Sony Multi-Terminal USB interface is/maybe a Sony proprietary intellectual property. This interface is commonly found on the micro SLR/SLR/movie machine that Sony has launched in recent years. There is often a \"MULTI\" mark around this interface to indicate \"Multi Terminal\". Correspond to Sony Multi-Terminal Protocol . It should be noted that there is a resistor pad on the other side of the USB splint, and a resistor with a resistance value greater than 100K needs to be soldered on it so that the interface can be correctly recognized by the Sony camera. Another type of connector does not place a resistor pad on the splint, so a 100K resistor needs to be connected in series between the pin labeled 6 and GND. Momentary Ground Correspond to Momentary Ground . Different cameras may have different interfaces/ports, please be sure to wire them correctly, otherwise it may cause the device to short circuit / lose warranty or even burn. BMPCC 4k/6k/6k Pro Recording Cable (ZITAY) ZITAY Official Link It is worth mentioning that this Recording Cable from ZITAY actually wraps an HDMI-CEC controller based on STM32F051 MCU under its gum shell. It is recommended to remove its shell and rewire it for using with Flowshutter. Panasonic LUMIX Remote Connector Panasonic/LUMIX uses special voltage/resistance detection mechanism to trigger the REC start/stop, therefore, please note that when using this brand of camera, a 2.5mm four-pin connector must be used to insert the REMOTE port of the camera body, and additional circuits need to be built with resistors so that the signal can be recognized by the camera. 3.3V Schmitt Trigger Correspond to 3.3V Schmitt Trigger . Different cameras may have different interfaces/ports, please be sure to wire them correctly, otherwise it may cause the device to short circuit / lose warranty or even burn.","title":"Wiring to Camera"},{"location":"flowshutter/wiring/#wiring-to-camera","text":"This page shows you some common wiring methods and precautions to use with the Flowshutter. We are working on adding support for more are more camera protocol/triggering methods, so this list is not exhaustive and keeps growing.","title":"Wiring to Camera"},{"location":"flowshutter/wiring/#sony-multi-usb","text":"Sony Multi-Terminal USB interface is/maybe a Sony proprietary intellectual property. This interface is commonly found on the micro SLR/SLR/movie machine that Sony has launched in recent years. There is often a \"MULTI\" mark around this interface to indicate \"Multi Terminal\". Correspond to Sony Multi-Terminal Protocol . It should be noted that there is a resistor pad on the other side of the USB splint, and a resistor with a resistance value greater than 100K needs to be soldered on it so that the interface can be correctly recognized by the Sony camera. Another type of connector does not place a resistor pad on the splint, so a 100K resistor needs to be connected in series between the pin labeled 6 and GND.","title":"Sony Multi-USB"},{"location":"flowshutter/wiring/#momentary-ground","text":"Correspond to Momentary Ground . Different cameras may have different interfaces/ports, please be sure to wire them correctly, otherwise it may cause the device to short circuit / lose warranty or even burn.","title":"Momentary Ground"},{"location":"flowshutter/wiring/#bmpcc-4k6k6k-pro-recording-cable-zitay","text":"ZITAY Official Link It is worth mentioning that this Recording Cable from ZITAY actually wraps an HDMI-CEC controller based on STM32F051 MCU under its gum shell. It is recommended to remove its shell and rewire it for using with Flowshutter.","title":"BMPCC 4k/6k/6k Pro Recording Cable (ZITAY)"},{"location":"flowshutter/wiring/#panasonic-lumix-remote-connector","text":"Panasonic/LUMIX uses special voltage/resistance detection mechanism to trigger the REC start/stop, therefore, please note that when using this brand of camera, a 2.5mm four-pin connector must be used to insert the REMOTE port of the camera body, and additional circuits need to be built with resistors so that the signal can be recognized by the camera.","title":"Panasonic LUMIX Remote Connector"},{"location":"flowshutter/wiring/#33v-schmitt-trigger","text":"Correspond to 3.3V Schmitt Trigger . Different cameras may have different interfaces/ports, please be sure to wire them correctly, otherwise it may cause the device to short circuit / lose warranty or even burn.","title":"3.3V Schmitt Trigger"},{"location":"guide/calibration/","text":"The purpose of the camera calibration process is to accurately determine the intrinsic parameters of a camera system. This consists of: focal length lens distortions other misalignments during the imaging process. These parameters can be found through Lens Calibration , which consists of imaging a known pattern, and analyzing the resulting footage. The Gyroflow lens calibrator looks like this: Related to lens calibration is estimating the rolling shutter frame readout time. Most DSLR's and consumer-grade video cameras use a rolling shutter sensors, which introduce warps and distortions in moving footage. It is highly recommended to get an accurate estimate of the rolling shutter before lens calibration and fill in the value in the calibration utility, but it can be done afterwards as well. Please have a look at gyroflow/rollingshutter for an accurate method of measuring rolling shutter or below for an estimated approach. Video Guide Nurk FPV's tutorial contains a calibration example: Getting calibration footage Display the calibration pattern on a flat computer monitor, preferably in full screen (available from the lens calibrator utility). You can also print it out if you prefer. In general, larger calibration patterns are preferred since focus will be closer to the focus during actual use, so use your largest screen/monitor. A bright screen with a slightly darkened room works well. Select the desired camera settings to calibrate for. Most importantly the field of view/focal length and aspect ratio, if applicable. Framerate and resolution doesn't matter, only if the resolution changes the field of view. Too low shutter speed may also cause undesirable motion blur. Record the pattern while slowly moving around to different angles and distances in one clip. 60 seconds is typically enough. Try to avoid motion blur and rolling shutter distortion with slow and steady movements, and make sure the full chessboard is in view. The following angles are recommended for getting distortion information from the full frame: Chessboard filling whole frame Chessboard seen from distance. Chessboard seen at an angle. Each edge of video frame aligned with edge of chessboard. Corner of chessboard aligned with corner of video. Finally, get fast motion for rolling shutter reference/estimation by doing a fast side-to-side yaw motions with the camera. This will produce rolling shutter effect where the lines will be bent, instead of straight. The calibration pattern can be displayed from the calibration utility. Alternatively, the default (14x8 radon) calibration pattern is available here: The previous default (14x8 chessboard) calibration pattern is also available below: Tip: Larger calibration patterns allow for more representative focal distance. Try using the largest screen available, especially with larger lenses. Creating camera preset Start the Gyroflow tool and click create new under the lens profile tab. Open the previously recorded calibration video file. Either begin auto calibration or manually add frames using add calibration point from the timeline context menu. Note: Skip the final fast side-to side motion during this step. After either the automatic or manual calibration process, check the reprojection error . This value describes the overall error between the preset and actual lens distortion based on the expected features of the calibration pattern. After all required frames are added and processed, the straight lines should be straight in the undistorted video. Reprojection error should typically be under 5 (pixels) with excellent calibrations giving values below 1. Fill in the preset information and export the lens profile. Try to add all relevant information about the camera/lens combination including field of view setting and lens focal length if applicable. If rolling shutter information is known in advance, fill in the frame readout time. If a successful calibration was achieved with a low reprojection error and no obvious artefacts, the profile can be submitted with the Upload lens profile to the database checkbox. You're now ready to use the new lens preset. These are stored as .json files. Estimating rolling shutter If your calibration video has matching gyro data, the following approach can be used to check the stabilization and estimate the rolling shutter visually. This method only works if the calibration clip had matching gyro data. An alternative and much more accurate method doesn't require gyro data, but instead requires an Arduino+LED or similar to generate a precise blinking frequency at e.g. 1 KHz. If you have the hardware, this is recommended over the visual method since it's an order of magnitude more accurate. Read more at gyroflow/rollingshutter . The visual method is as follows: 1. Load the same clip in main window, load the lens profile you just calibrated, sync the gyro with video. 2. Focus on that fast sideways motion part, go to Stabilization -> Rolling shutter correction, and move the slider until the rolling shutter effect is fixed, ie. the lines become straight and are not bent anymore. You may need to reverse the rolling shutter direction. 3. Edit your created lens profile json with notepad, and replace \"frame_readout_time\": null, , to e.g. \"frame_readout_time\": 15.5, (15.5ms is an example value). This value will automatically be applied when using this preset. Additional calibration options The lens calibrator contains additional options. Default output size Radial lens undistortion typically results in the image being stretched more in the horizontal axis (use the FOV slider to see this). For instance, undistorted 4:3 GoPro video: Notice that the area of the valid rectangle is close to a 16:9 aspect ratio as opposed to 4:3. In these cases, the default output size can be modified to a 16:9 one. For cameras with minimal fisheye distortion, or even with pincushion distortion, the resulting valid aspect ratio is close to the original one. For these cameras, just use the input resolution for the default output size. Sharpness limit Sets the minimum required sharpness for the calibration pattern. If the pattern failed to detect due to focus or blurriness, try increasing this limit.","title":"Camera Calibration"},{"location":"guide/calibration/#video-guide","text":"Nurk FPV's tutorial contains a calibration example:","title":"Video Guide"},{"location":"guide/calibration/#getting-calibration-footage","text":"Display the calibration pattern on a flat computer monitor, preferably in full screen (available from the lens calibrator utility). You can also print it out if you prefer. In general, larger calibration patterns are preferred since focus will be closer to the focus during actual use, so use your largest screen/monitor. A bright screen with a slightly darkened room works well. Select the desired camera settings to calibrate for. Most importantly the field of view/focal length and aspect ratio, if applicable. Framerate and resolution doesn't matter, only if the resolution changes the field of view. Too low shutter speed may also cause undesirable motion blur. Record the pattern while slowly moving around to different angles and distances in one clip. 60 seconds is typically enough. Try to avoid motion blur and rolling shutter distortion with slow and steady movements, and make sure the full chessboard is in view. The following angles are recommended for getting distortion information from the full frame: Chessboard filling whole frame Chessboard seen from distance. Chessboard seen at an angle. Each edge of video frame aligned with edge of chessboard. Corner of chessboard aligned with corner of video. Finally, get fast motion for rolling shutter reference/estimation by doing a fast side-to-side yaw motions with the camera. This will produce rolling shutter effect where the lines will be bent, instead of straight. The calibration pattern can be displayed from the calibration utility. Alternatively, the default (14x8 radon) calibration pattern is available here: The previous default (14x8 chessboard) calibration pattern is also available below: Tip: Larger calibration patterns allow for more representative focal distance. Try using the largest screen available, especially with larger lenses.","title":"Getting calibration footage"},{"location":"guide/calibration/#creating-camera-preset","text":"Start the Gyroflow tool and click create new under the lens profile tab. Open the previously recorded calibration video file. Either begin auto calibration or manually add frames using add calibration point from the timeline context menu. Note: Skip the final fast side-to side motion during this step. After either the automatic or manual calibration process, check the reprojection error . This value describes the overall error between the preset and actual lens distortion based on the expected features of the calibration pattern. After all required frames are added and processed, the straight lines should be straight in the undistorted video. Reprojection error should typically be under 5 (pixels) with excellent calibrations giving values below 1. Fill in the preset information and export the lens profile. Try to add all relevant information about the camera/lens combination including field of view setting and lens focal length if applicable. If rolling shutter information is known in advance, fill in the frame readout time. If a successful calibration was achieved with a low reprojection error and no obvious artefacts, the profile can be submitted with the Upload lens profile to the database checkbox. You're now ready to use the new lens preset. These are stored as .json files.","title":"Creating camera preset"},{"location":"guide/calibration/#estimating-rolling-shutter","text":"If your calibration video has matching gyro data, the following approach can be used to check the stabilization and estimate the rolling shutter visually. This method only works if the calibration clip had matching gyro data. An alternative and much more accurate method doesn't require gyro data, but instead requires an Arduino+LED or similar to generate a precise blinking frequency at e.g. 1 KHz. If you have the hardware, this is recommended over the visual method since it's an order of magnitude more accurate. Read more at gyroflow/rollingshutter . The visual method is as follows: 1. Load the same clip in main window, load the lens profile you just calibrated, sync the gyro with video. 2. Focus on that fast sideways motion part, go to Stabilization -> Rolling shutter correction, and move the slider until the rolling shutter effect is fixed, ie. the lines become straight and are not bent anymore. You may need to reverse the rolling shutter direction. 3. Edit your created lens profile json with notepad, and replace \"frame_readout_time\": null, , to e.g. \"frame_readout_time\": 15.5, (15.5ms is an example value). This value will automatically be applied when using this preset.","title":"Estimating rolling shutter"},{"location":"guide/calibration/#additional-calibration-options","text":"The lens calibrator contains additional options.","title":"Additional calibration options"},{"location":"guide/calibration/#default-output-size","text":"Radial lens undistortion typically results in the image being stretched more in the horizontal axis (use the FOV slider to see this). For instance, undistorted 4:3 GoPro video: Notice that the area of the valid rectangle is close to a 16:9 aspect ratio as opposed to 4:3. In these cases, the default output size can be modified to a 16:9 one. For cameras with minimal fisheye distortion, or even with pincushion distortion, the resulting valid aspect ratio is close to the original one. For these cameras, just use the input resolution for the default output size.","title":"Default output size"},{"location":"guide/calibration/#sharpness-limit","text":"Sets the minimum required sharpness for the calibration pattern. If the pattern failed to detect due to focus or blurriness, try increasing this limit.","title":"Sharpness limit"},{"location":"guide/installation/","text":"Installation Minimum system requirements: Here are the Gyroflow minimum requirements: Windows 10 64-bit (1809 or later) Windows \"N\" versions: Install the \"Media Feature Pack\", go to Settings -> Apps -> Optional features -> Add a feature -> Select \"Media Feature Pack\" -> Click Install macOS 10.14 or later (both Intel and Apple Silicon are supported natively) Linux: .tar.gz package (recommended): Debian 10+, Ubuntu 18.10+, CentOS 8.2+, openSUSE 15.3+. Other distros require glibc 2.28+ ( ldd --version to check) .AppImage should work everywhere Make sure you have latest graphics drivers installed Possibly needed packages: sudo apt install libva2 libvdpau1 libasound2 libxkbcommon0 libpulse0 libc++-dev vdpau-va-driver libvulkan1 GPU specific packages: NVIDIA: nvidia-opencl-icd nvidia-vdpau-driver nvidia-egl-icd nvidia-vulkan-icd libnvcuvid1 libnvidia-encode1 Intel: intel-media-va-driver i965-va-driver beignet-opencl-icd intel-opencl-icd AMD: mesa-vdpau-drivers mesa-va-drivers mesa-opencl-icd libegl-mesa0 mesa-vulkan-drivers Android 6+ Official Releases Prebuilt executables are available for Windows, Mac, and Linux. These can be found on the GitHub Releases Nightly builds In some cases you may need to download the latest nightly build : For example, a known bug was fixed in the nightly build and you need to use it urgently. Or, you want to see how the latest committed translation actually works in the app, Whether the translation needs to be fine-tuned to match the overall translation style. In general, however, we discourage casually trying nightly builds unless you know what you're doing! Build local version For development purposes, a local version can be built. For the building instructions, see the development section on GitHub :","title":"Installation"},{"location":"guide/installation/#installation","text":"","title":"Installation"},{"location":"guide/installation/#minimum-system-requirements","text":"Here are the Gyroflow minimum requirements: Windows 10 64-bit (1809 or later) Windows \"N\" versions: Install the \"Media Feature Pack\", go to Settings -> Apps -> Optional features -> Add a feature -> Select \"Media Feature Pack\" -> Click Install macOS 10.14 or later (both Intel and Apple Silicon are supported natively) Linux: .tar.gz package (recommended): Debian 10+, Ubuntu 18.10+, CentOS 8.2+, openSUSE 15.3+. Other distros require glibc 2.28+ ( ldd --version to check) .AppImage should work everywhere Make sure you have latest graphics drivers installed Possibly needed packages: sudo apt install libva2 libvdpau1 libasound2 libxkbcommon0 libpulse0 libc++-dev vdpau-va-driver libvulkan1 GPU specific packages: NVIDIA: nvidia-opencl-icd nvidia-vdpau-driver nvidia-egl-icd nvidia-vulkan-icd libnvcuvid1 libnvidia-encode1 Intel: intel-media-va-driver i965-va-driver beignet-opencl-icd intel-opencl-icd AMD: mesa-vdpau-drivers mesa-va-drivers mesa-opencl-icd libegl-mesa0 mesa-vulkan-drivers Android 6+","title":"Minimum system requirements:"},{"location":"guide/installation/#official-releases","text":"Prebuilt executables are available for Windows, Mac, and Linux. These can be found on the GitHub Releases","title":"Official Releases"},{"location":"guide/installation/#nightly-builds","text":"In some cases you may need to download the latest nightly build : For example, a known bug was fixed in the nightly build and you need to use it urgently. Or, you want to see how the latest committed translation actually works in the app, Whether the translation needs to be fine-tuned to match the overall translation style. In general, however, we discourage casually trying nightly builds unless you know what you're doing!","title":"Nightly builds"},{"location":"guide/installation/#build-local-version","text":"For development purposes, a local version can be built. For the building instructions, see the development section on GitHub :","title":"Build local version"},{"location":"guide/quickstart/","text":"Getting Started with Gyroflow 1.0 + Welcome to the Gyroflow Quick Start Guide! Please use the Navigation Bar at the bottom of each page for a more step-by-step approach, or use the Navigation Menu on the left to get to a Hardware-specific Guide. Longer pages have a Table of Contents menu found on the right of the page. We hope these pages have been helpful and you enjoy using Gyroflow! Nurk FPV also made a nice tutorial for getting started with the software: Download the executable corresponding to your system: https://github.com/gyroflow/gyroflow/releases Run the executable. Either open or drag your video file to Gyroflow. Lens profile and motion data files are automatically detected for some cameras (GoPros). Otherwise search for the correct lens profile and open the motion data file. Playback video to check if additional synchronization is required. If so, right-click on the timeline and select Auto sync here at at least two points of the video where some motion is present. This synchronises the gyro data and the video. Play with the stabilization options and algorithms. They all give different \"looks\" for the final result. Select output file settings and export.","title":"Getting Started"},{"location":"guide/quickstart/#getting-started-with-gyroflow-10","text":"Welcome to the Gyroflow Quick Start Guide! Please use the Navigation Bar at the bottom of each page for a more step-by-step approach, or use the Navigation Menu on the left to get to a Hardware-specific Guide. Longer pages have a Table of Contents menu found on the right of the page. We hope these pages have been helpful and you enjoy using Gyroflow! Nurk FPV also made a nice tutorial for getting started with the software: Download the executable corresponding to your system: https://github.com/gyroflow/gyroflow/releases Run the executable. Either open or drag your video file to Gyroflow. Lens profile and motion data files are automatically detected for some cameras (GoPros). Otherwise search for the correct lens profile and open the motion data file. Playback video to check if additional synchronization is required. If so, right-click on the timeline and select Auto sync here at at least two points of the video where some motion is present. This synchronises the gyro data and the video. Play with the stabilization options and algorithms. They all give different \"looks\" for the final result. Select output file settings and export.","title":"Getting Started with Gyroflow 1.0 +"},{"location":"guide/settings/","text":"Gyroflow has a large number of settings for customizing everything. This page contains a short description and guide to each of the settings. Luckily, many of the settings are self-explanatory. Figure: Full screenshot Input/video information After opening a video file, video information and metadata are displayed here. Frame rate Set this value to the actual recording frame rate if it doesn't match the detected frame rate. This is the case for footage from some high speed cameras which play back in slow motion. Rotation Modify the angle if unexpected video rotation is present (e.g. camera accidentally recording using portrait mode). Lens profile Gyroflow requires correct lens profiles for undistortion and correctly applying the stabilization. For GoPro cameras, this is automatically detected based on the metadata. For other cameras, either search for the lens profile, or create a new profile (see the calibration guide ). The lens profile is specific to a combination of a camera, a lens, a field of view, and the recording setting/aspect ratio. In general, it is best if the profile matches the setup exactly, but the same profile can be used if everything else matches except: Frame rate Resolution (with the same FOV and aspect ratio) This is the case since the lens distortion is independent from the framerate and is scaled to account for resolution differences. Lens profiles are stored as JSON files, which can be loaded without being part of the database. Motion data The motion data can either be embedded in the video file (GoPro/Insta360/Sony) or loaded as a separate motion data file (drone blackbox/Runcam/etc). Videos with embedded motion data can be treated as a motion data file as well, meaning an action camera like a GoPro can be mounted on a larger camera as a motion logger. The log detection and parsing uses telemetry-parser For more information about specific gyro logging methods, see pages under Gyro Logging . Low pass filter Gyro data (especially from drones) can be noisy without filtering. Low pass filters essentially reduce frequencies above the cutoff frequency. If the gyro data appears too noisy, try enabling this filter with a cutoff of 50 Hz, with lower frequencies giving more filtering ( more info here ). Rotation If the gyroscope sensor isn't aligned at right angles with the camera, an additional rotation can be applied here. For FPV users using blackbox data with a camera tilt, change the Pitch value to match the angle between the camera and the flight controller. IMU Orientation The compact xyz notation is used to describe the right-angle orientation between the camera and the gyro, with uppercase letters being positive and lowercase being negative. In most cases, this is automatically detected, but if stabilization appears to be applied in the wrong direction/axis, changing the IMU orientation may be required. If you have some input motion data, then Yxz means output (displayed in the graph) is computed as follows: Take y from input and put in x of output Take -x from input and put in y of output Take -z from input and put in z of output Integration method For translating the raw gyroscope and accelerometer sensor readings to actual orientations usable for video stabilization, an integration method is used. Currently available are: None - Only applicable for cameras with pre-computed orientations (Hero 8 and newer) Madgwick filter Complementary filter Mahony filter Gyroflow integration Madgwick, Complementary, and Mahony all use a combination of gyroscope and accelerometer for estimating the orientation. The accelerometer allows for determining the downwards direction, meaning these integrators can be used with Lock horizon . With horizon lock, the Complementary filter usually gives decent results with the least horizon drift, but you can compare yourself. By comparison, the Gyroflow option only uses the gyroscope and doesn't work with horizon leveling. For hero 8 and newer, selecting None means no synchronization is required at all. Synchronization Synchronization is typically required between the video and and gyro data. This can either be auto-sync, or by manually syncing at specified times by right-clicking the timeline. Rough gyro offset If a significant delay is present between the start of the video recording and gyro recording, the rough gyro offset needs to be changed. Example: if you start video recording followed by gyro recording 30 seconds later, use 30 s here. Sync search size Gyroflow analyzes a segment of the video, and attempts to find the most likely match within this search size in order to avoid false positives. Max sync points Number of automatically added sync points. Analyze every n-th frame This is typically left unchanged. By setting this to a number larger than 1, frames are skipped during the motion analysis. One use case is high framerate footage, where the relative motion between two subsequent frames is too small for reliable sync. Time to analyze per sync point Determines the number of frames analyzed analyzed for each sync point. More frames take slightly longer, but may give a better sync. The default is typically fine. Optical flow method Select the optical flow implementation. Either OpenCV (typically faster and preferred) or AKAZE. Offset calculation method This is the method used to estimate the gyro-video offset. Using essential matrix - Estimate relative roll/pitch/yaw angular rates between each frame, and correlate with gyro sensor data. Using visual features - Estimate the gyro offset such that the tracked features move the least between frames. Low pass filter Apply a low pass filter to the estimated video motion. This is rarely needed. Show detected features / Show optical flow Shows the motion in the video player during playback Stabilization This is an exciting menu: The actual video stabilization! In general, try playing with the different stabilization algorithms. Each result in a different \"look\" for the stabilized video. If you're interested in developing your own stabilization algorithm, take a look here . FOV Apply a scale to the field of view of the output video. Stabilization algorithm The currently available stabilization algorithms are: No smoothing - Useful if only lens undistortion is desired Plain 3D - Simple general purpose smoothing algorithm described here . Smoothing applied symmetrically in 3D with no rotation limit (doesn't work for rapid camera motion). Velocity dampened - Decreases the smoothing during significant camera motion in order to avoid the image moving out of frame. Velocity dampened per axis - Similar to Velocity dampened with individual roll/pitch/yaw smoothness control. Typically the roll axis can be smoothed out more. Lock horizon - Attempts to keep the horizon level. Works best for flight without fast rotational moves since some gyros can be maxed out. Try with the complementary filter. Fixed camera - Points the virtual camera in a fixed, used-defined direction. Can be useful for debugging or tweaking sync. Crop Select the behavior of the cropping. No cropping - Remain at the user-defined FOV throughout the video Dynamic cropping - Dynamically adjust the field of view in order to hide any borders throughout the video. The Smoothing window influences how quickly the FOV changes in response to different stabilized frame orientations. Static crop - Static crop with FOV=1 being the FOV at which no edges are visible throughout the video. Rolling shutter correction Rolling shutter artifacts are visible during fast camera motion, and appears as \"wobbling\" or skewed lines. This option requires precise gyro-video sync. Find a spot in the video with clear rolling shutter artifacts, and adjust the frame readout time until these artifacts are minimized. By default, the frame readout is assumed to be from top to bottom. This is changed with the checkbox. The readout time can also be estimated with the \"Estimate rolling shutter here\" option in the context menu of the timeline, although this is experimental. Export The options here are fairly self-explanatory. For any doubts, see the tooltips. By default, the resolution and bitrate are selected to correspond closely to the input file From the dropdown of the export button, it is possible to export a .gyroflow . This file contains all the required data and sync information for a video file, and is automatically detected the next time you want to process the same file.","title":"Settings Explanation"},{"location":"guide/settings/#inputvideo-information","text":"After opening a video file, video information and metadata are displayed here.","title":"Input/video information"},{"location":"guide/settings/#frame-rate","text":"Set this value to the actual recording frame rate if it doesn't match the detected frame rate. This is the case for footage from some high speed cameras which play back in slow motion.","title":"Frame rate"},{"location":"guide/settings/#rotation","text":"Modify the angle if unexpected video rotation is present (e.g. camera accidentally recording using portrait mode).","title":"Rotation"},{"location":"guide/settings/#lens-profile","text":"Gyroflow requires correct lens profiles for undistortion and correctly applying the stabilization. For GoPro cameras, this is automatically detected based on the metadata. For other cameras, either search for the lens profile, or create a new profile (see the calibration guide ). The lens profile is specific to a combination of a camera, a lens, a field of view, and the recording setting/aspect ratio. In general, it is best if the profile matches the setup exactly, but the same profile can be used if everything else matches except: Frame rate Resolution (with the same FOV and aspect ratio) This is the case since the lens distortion is independent from the framerate and is scaled to account for resolution differences. Lens profiles are stored as JSON files, which can be loaded without being part of the database.","title":"Lens profile"},{"location":"guide/settings/#motion-data","text":"The motion data can either be embedded in the video file (GoPro/Insta360/Sony) or loaded as a separate motion data file (drone blackbox/Runcam/etc). Videos with embedded motion data can be treated as a motion data file as well, meaning an action camera like a GoPro can be mounted on a larger camera as a motion logger. The log detection and parsing uses telemetry-parser For more information about specific gyro logging methods, see pages under Gyro Logging .","title":"Motion data"},{"location":"guide/settings/#low-pass-filter","text":"Gyro data (especially from drones) can be noisy without filtering. Low pass filters essentially reduce frequencies above the cutoff frequency. If the gyro data appears too noisy, try enabling this filter with a cutoff of 50 Hz, with lower frequencies giving more filtering ( more info here ).","title":"Low pass filter"},{"location":"guide/settings/#rotation_1","text":"If the gyroscope sensor isn't aligned at right angles with the camera, an additional rotation can be applied here. For FPV users using blackbox data with a camera tilt, change the Pitch value to match the angle between the camera and the flight controller.","title":"Rotation"},{"location":"guide/settings/#imu-orientation","text":"The compact xyz notation is used to describe the right-angle orientation between the camera and the gyro, with uppercase letters being positive and lowercase being negative. In most cases, this is automatically detected, but if stabilization appears to be applied in the wrong direction/axis, changing the IMU orientation may be required. If you have some input motion data, then Yxz means output (displayed in the graph) is computed as follows: Take y from input and put in x of output Take -x from input and put in y of output Take -z from input and put in z of output","title":"IMU Orientation"},{"location":"guide/settings/#integration-method","text":"For translating the raw gyroscope and accelerometer sensor readings to actual orientations usable for video stabilization, an integration method is used. Currently available are: None - Only applicable for cameras with pre-computed orientations (Hero 8 and newer) Madgwick filter Complementary filter Mahony filter Gyroflow integration Madgwick, Complementary, and Mahony all use a combination of gyroscope and accelerometer for estimating the orientation. The accelerometer allows for determining the downwards direction, meaning these integrators can be used with Lock horizon . With horizon lock, the Complementary filter usually gives decent results with the least horizon drift, but you can compare yourself. By comparison, the Gyroflow option only uses the gyroscope and doesn't work with horizon leveling. For hero 8 and newer, selecting None means no synchronization is required at all.","title":"Integration method"},{"location":"guide/settings/#synchronization","text":"Synchronization is typically required between the video and and gyro data. This can either be auto-sync, or by manually syncing at specified times by right-clicking the timeline.","title":"Synchronization"},{"location":"guide/settings/#rough-gyro-offset","text":"If a significant delay is present between the start of the video recording and gyro recording, the rough gyro offset needs to be changed. Example: if you start video recording followed by gyro recording 30 seconds later, use 30 s here.","title":"Rough gyro offset"},{"location":"guide/settings/#sync-search-size","text":"Gyroflow analyzes a segment of the video, and attempts to find the most likely match within this search size in order to avoid false positives.","title":"Sync search size"},{"location":"guide/settings/#max-sync-points","text":"Number of automatically added sync points.","title":"Max sync points"},{"location":"guide/settings/#analyze-every-n-th-frame","text":"This is typically left unchanged. By setting this to a number larger than 1, frames are skipped during the motion analysis. One use case is high framerate footage, where the relative motion between two subsequent frames is too small for reliable sync.","title":"Analyze every n-th frame"},{"location":"guide/settings/#time-to-analyze-per-sync-point","text":"Determines the number of frames analyzed analyzed for each sync point. More frames take slightly longer, but may give a better sync. The default is typically fine.","title":"Time to analyze per sync point"},{"location":"guide/settings/#optical-flow-method","text":"Select the optical flow implementation. Either OpenCV (typically faster and preferred) or AKAZE.","title":"Optical flow method"},{"location":"guide/settings/#offset-calculation-method","text":"This is the method used to estimate the gyro-video offset. Using essential matrix - Estimate relative roll/pitch/yaw angular rates between each frame, and correlate with gyro sensor data. Using visual features - Estimate the gyro offset such that the tracked features move the least between frames.","title":"Offset calculation method"},{"location":"guide/settings/#low-pass-filter_1","text":"Apply a low pass filter to the estimated video motion. This is rarely needed.","title":"Low pass filter"},{"location":"guide/settings/#show-detected-features-show-optical-flow","text":"Shows the motion in the video player during playback","title":"Show detected features / Show optical flow"},{"location":"guide/settings/#stabilization","text":"This is an exciting menu: The actual video stabilization! In general, try playing with the different stabilization algorithms. Each result in a different \"look\" for the stabilized video. If you're interested in developing your own stabilization algorithm, take a look here .","title":"Stabilization"},{"location":"guide/settings/#fov","text":"Apply a scale to the field of view of the output video.","title":"FOV"},{"location":"guide/settings/#stabilization-algorithm","text":"The currently available stabilization algorithms are: No smoothing - Useful if only lens undistortion is desired Plain 3D - Simple general purpose smoothing algorithm described here . Smoothing applied symmetrically in 3D with no rotation limit (doesn't work for rapid camera motion). Velocity dampened - Decreases the smoothing during significant camera motion in order to avoid the image moving out of frame. Velocity dampened per axis - Similar to Velocity dampened with individual roll/pitch/yaw smoothness control. Typically the roll axis can be smoothed out more. Lock horizon - Attempts to keep the horizon level. Works best for flight without fast rotational moves since some gyros can be maxed out. Try with the complementary filter. Fixed camera - Points the virtual camera in a fixed, used-defined direction. Can be useful for debugging or tweaking sync.","title":"Stabilization algorithm"},{"location":"guide/settings/#crop","text":"Select the behavior of the cropping. No cropping - Remain at the user-defined FOV throughout the video Dynamic cropping - Dynamically adjust the field of view in order to hide any borders throughout the video. The Smoothing window influences how quickly the FOV changes in response to different stabilized frame orientations. Static crop - Static crop with FOV=1 being the FOV at which no edges are visible throughout the video.","title":"Crop"},{"location":"guide/settings/#rolling-shutter-correction","text":"Rolling shutter artifacts are visible during fast camera motion, and appears as \"wobbling\" or skewed lines. This option requires precise gyro-video sync. Find a spot in the video with clear rolling shutter artifacts, and adjust the frame readout time until these artifacts are minimized. By default, the frame readout is assumed to be from top to bottom. This is changed with the checkbox. The readout time can also be estimated with the \"Estimate rolling shutter here\" option in the context menu of the timeline, although this is experimental.","title":"Rolling shutter correction"},{"location":"guide/settings/#export","text":"The options here are fairly self-explanatory. For any doubts, see the tooltips. By default, the resolution and bitrate are selected to correspond closely to the input file From the dropdown of the export button, it is possible to export a .gyroflow . This file contains all the required data and sync information for a video file, and is automatically detected the next time you want to process the same file.","title":"Export"},{"location":"guide/shortcuts/","text":"","title":"Shortcuts"},{"location":"guide/synchronization/","text":"This page describes the gyro-video synchronization process in more detail. In a lot of cases, automatic sync works out of the box, so this is only required for tricky scenarios.","title":"Synchronization"},{"location":"guide/workflow/","text":"General Workflows This page contains several common minimal workflows for stabilizing video with Gyroflow. Cameras w/ Motion Data It is relatively simple to use a camera that can directly output gyro data in the machine, just drag and drop the video file (and gyro log) to gyroflow. Cameras without Motion Data The use of the camera that cannot directly output the gyro data in the machine is more flexible. The video file and the gyro log are from different devices, and the two parts need to be manually added to gyroflow. Action as logger FC as logger","title":"Workflow"},{"location":"guide/workflow/#general-workflows","text":"This page contains several common minimal workflows for stabilizing video with Gyroflow.","title":"General Workflows"},{"location":"guide/workflow/#cameras-w-motion-data","text":"It is relatively simple to use a camera that can directly output gyro data in the machine, just drag and drop the video file (and gyro log) to gyroflow.","title":"Cameras w/ Motion Data"},{"location":"guide/workflow/#cameras-without-motion-data","text":"The use of the camera that cannot directly output the gyro data in the machine is more flexible. The video file and the gyro log are from different devices, and the two parts need to be manually added to gyroflow.","title":"Cameras without Motion Data"},{"location":"guide/workflow/#action-as-logger","text":"","title":"Action as logger"},{"location":"guide/workflow/#fc-as-logger","text":"","title":"FC as logger"},{"location":"integrations/integrations/","text":"This page contains tools or projects designed to work with Gyroflow. Gyroflow OpenFX The Gyroflow OpenFX plugin allows for applying stabilization using a .gyroflow file to a video directly in a video editor such as Davinci Resolve. This allows for stabilizing RAW and specialised video formats. This plugin is under development by Ilya Epifanov . Downloads and instructions can be found on the GitHub Repository: gyroflow-ofx Gyroflow to CSV Gyroflow to CSV by EmberLightVFX can convert Gyroflow project files to a CSV format containing the camera motion. This can be imported in software such as Blackmagic Fusion and may be used for VFX work. Gyroflow to CSV","title":"List of tools"},{"location":"integrations/integrations/#gyroflow-openfx","text":"The Gyroflow OpenFX plugin allows for applying stabilization using a .gyroflow file to a video directly in a video editor such as Davinci Resolve. This allows for stabilizing RAW and specialised video formats. This plugin is under development by Ilya Epifanov . Downloads and instructions can be found on the GitHub Repository: gyroflow-ofx","title":"Gyroflow OpenFX"},{"location":"integrations/integrations/#gyroflow-to-csv","text":"Gyroflow to CSV by EmberLightVFX can convert Gyroflow project files to a CSV format containing the camera motion. This can be imported in software such as Blackmagic Fusion and may be used for VFX work. Gyroflow to CSV","title":"Gyroflow to CSV"},{"location":"logging/actioncamlogger/","text":"Due to the flexibility of Gyroflow, the gyro source and the video source can be \"mismatched\". This means that an action camera with internal gyro logging (e.g. GoPro) can be mounted to a high-end cinema camera acting as a gyro logger. This setup is illustrated below. The advantages of this setup is the availability of GoPros/Insta360 cameras among filmmakers, meaning no additional hardware other than some fasteners. With this setup, a number of things should be considered: The cinema camera and logger camera should be rigidly attached to each other to avoid mismatching motion data. The two should ideally be oriented in the same direction to avoid additional angle corrections. Starting recording of the two cameras at almost the same time, or with a small fixed offset (e.g. 10 seconds) makes synchronization easier. This setup has successfully been used with GoPro Hero 6/8/9, the Insta360 OneR/Go 2 among others. In general, any camera with gyro logging should work, assuming the gyro data is clean and correct. When using a GoPro hero 8 or newer as a gyro logger, the internally computed orientations ( None integration method) should not be used, since these orientations only correspond to each frame from the GoPro file.","title":"Action cam as logger"},{"location":"logging/betaflight/","text":"Betaflight/Cleanflight/Inav/Emuflight/etc form a popular family of flight control firmware for high-performance multicopters. By using the built-in blackbox logging feature, gyro data for use with Gyroflow video stabilization can be collected. This was in fact one of the initial goals of the project! Betaflight, Cleanflight, Inav, Emuflight etc. all use more or less the same structure for handling blackbox data logging, so this page covers all of these. Hardware As you may already know, the above mentioned flight firmwares can all run on the same type of hardware. A flight controller supporting this family of flight firmwares typically contain: STMicroelectronics 32 bit microcontroller (F4, F7, G4, H7) MEMS inertial measurement unit (MPU6000, BMI270, ICM2xxxx, ICM4xxxx etc.) Some flight controllers have an onboard magnetometer. In general, this is not required for video stabilization purposes unless absolute orientation is desired. Different gyros exhibit different behaviors in terms of data quality, noise, etc. In general, if the IMU is capable of providing clean data for the drone control loop, the same data is suitable for video stabilization purposes. For blackbox data logging, the hardware typically either contains an onboard SPI Flash chip, or a slot for an SD card. If neither of these are available, additional hardware solutions can be connected to the flight controller in order to enable blackbox logging. This can be using: The Openlager - A open source and commercially available board containing an STM32f4 and a MicroSD slot for logging high rate data through a spare serial port. Tiny Blackbox - An open source ultra-light logger containing a 16 MB flash chip. SparkFun OpenLog - A serial-based logger similar to the Openlager. This is no longer officially supported by Betaflight etc. due to data rate limitations. Betaflight/(Cleanflight/Emuflight?) Required software: Betaflight/Cleanflight/Emuflight configurator Betaflight blackbox explorer The following should be a decent starting point for the blackbox configuration 250 Hz logging rate Debug mode: None If you're running Betaflight 4.3 or newer, it is possible to deselect specific elements of the data logging in order to save precious recording space. Gyroflow logger preset We have a gyroflow-betaflight presets source for your convenience. You can easily set it up like the picture shown below: Once the gyroflow logger preset is actived, you'll see some special gyroflow presets: Gyroflow minimal settings : for users who wanna use the blackbox data from main FC as motion data for video stabilization. Sencondary FC as Gyroflow motion logger : for users who use a secondary FC as a gyroflow motion logger. Gyroflow BMI270 Filter sttings : for users whose FC has a BMI270 sensor and want to use it as a gyroflow motion logger. Flowbox target settings : preset for flowbox and flowbox+flowshutter CLI commands Or you might prefer the \"old fashion\", from the CLI: set blackbox_disable_pids = ON set blackbox_disable_rc = ON set blackbox_disable_setpoint = ON set blackbox_disable_bat = ON set blackbox_disable_mag = ON set blackbox_disable_alt = ON set blackbox_disable_rssi = ON set blackbox_disable_debug = ON set blackbox_disable_motors = ON set blackbox_disable_gps = ON Betaflight configurator blackbox tab Acknowledgements logger-presets : Forked from betaflight/firmware-persets","title":"Betaflight/INav/Cleanflight/etc."},{"location":"logging/betaflight/#hardware","text":"As you may already know, the above mentioned flight firmwares can all run on the same type of hardware. A flight controller supporting this family of flight firmwares typically contain: STMicroelectronics 32 bit microcontroller (F4, F7, G4, H7) MEMS inertial measurement unit (MPU6000, BMI270, ICM2xxxx, ICM4xxxx etc.) Some flight controllers have an onboard magnetometer. In general, this is not required for video stabilization purposes unless absolute orientation is desired. Different gyros exhibit different behaviors in terms of data quality, noise, etc. In general, if the IMU is capable of providing clean data for the drone control loop, the same data is suitable for video stabilization purposes. For blackbox data logging, the hardware typically either contains an onboard SPI Flash chip, or a slot for an SD card. If neither of these are available, additional hardware solutions can be connected to the flight controller in order to enable blackbox logging. This can be using: The Openlager - A open source and commercially available board containing an STM32f4 and a MicroSD slot for logging high rate data through a spare serial port. Tiny Blackbox - An open source ultra-light logger containing a 16 MB flash chip. SparkFun OpenLog - A serial-based logger similar to the Openlager. This is no longer officially supported by Betaflight etc. due to data rate limitations.","title":"Hardware"},{"location":"logging/betaflight/#betaflightcleanflightemuflight","text":"Required software: Betaflight/Cleanflight/Emuflight configurator Betaflight blackbox explorer The following should be a decent starting point for the blackbox configuration 250 Hz logging rate Debug mode: None If you're running Betaflight 4.3 or newer, it is possible to deselect specific elements of the data logging in order to save precious recording space.","title":"Betaflight/(Cleanflight/Emuflight?)"},{"location":"logging/betaflight/#gyroflow-logger-preset","text":"We have a gyroflow-betaflight presets source for your convenience. You can easily set it up like the picture shown below: Once the gyroflow logger preset is actived, you'll see some special gyroflow presets: Gyroflow minimal settings : for users who wanna use the blackbox data from main FC as motion data for video stabilization. Sencondary FC as Gyroflow motion logger : for users who use a secondary FC as a gyroflow motion logger. Gyroflow BMI270 Filter sttings : for users whose FC has a BMI270 sensor and want to use it as a gyroflow motion logger. Flowbox target settings : preset for flowbox and flowbox+flowshutter","title":"Gyroflow logger preset"},{"location":"logging/betaflight/#cli-commands","text":"Or you might prefer the \"old fashion\", from the CLI: set blackbox_disable_pids = ON set blackbox_disable_rc = ON set blackbox_disable_setpoint = ON set blackbox_disable_bat = ON set blackbox_disable_mag = ON set blackbox_disable_alt = ON set blackbox_disable_rssi = ON set blackbox_disable_debug = ON set blackbox_disable_motors = ON set blackbox_disable_gps = ON Betaflight configurator blackbox tab","title":"CLI commands"},{"location":"logging/betaflight/#acknowledgements","text":"logger-presets : Forked from betaflight/firmware-persets","title":"Acknowledgements"},{"location":"logging/customlogger/","text":"Custom and DIY hardware logging This page contains an example of how data logging can be implemented and existing projects you can build and/or adapt. Existing DIY options esplog by VladimirP1 A ESP32-based motion data logger with wireless control and data transfer. Available as a small breakout board version or a tiny single PCB version. The developer and testers of esplog can be found on the Gyroflow discord. esplog on Github Flowshutter and Flowbox by Dusking1 These are motion data loggers developed by Dusking1 using the Betaflight firmware. The Flowshutter is designed to be capable of triggering a variety of cameras for a one-click operation. Flowshutter on Github Hardware An MEMS Inertial Measurement Unit (MEMS IMU) is a chip containing a gyroscope and an accelerometer. The gyroscope measures the rotational rate, while the accelerometer measures acceleration as the name implies. Gyroflow requires the gyroscope, while the accelerometer is optional and only required if horizon referencing is desired. An example of the acceleration and rotational axes around a camera is illustrated above. Many camera systems already contain such an IMU for electronic image stabilization, so in some cases, it is possible to allow for motion logging through a firmware update. For a dedicated logger, a simple combination of a memory device (MicroSD/SPI Flash chip etc.), a microcontroller, and an inertial measurement unit suffices. This hardware combination is readily available as low-cost drone flight controllers, which can act as loggers as described on another page . For arduino and embedded electronics hobbyists, this is a fairly basic project that can be built on a breadboard/perfboard Software/Firmware On the software and firmware side, the inertial measurement unit should be configured correctly. Refer to the datasheet of your IMU for information about how to configure this exactly. It has been found that the following IMU settings offer a reasonable starting point. logging rate: 500 Hz Low pass filter cutoff: 50 to 100 Hz gyro scaling: 1000 deg/s acceleration scaling: +/- 8 g The minimum logging rate sufficient for stabilization is approximately 100 Hz, but note that such a low logging rate requires excellent filtering in order to avoid data loss and aliasing. Using a 500 Hz logging rate with a 100 Hz cutoff allows for some margin of error in terms of aliasing. Logging Logging of Gyroscope, and optionally, Accelerometer and Magnetometer can be in various formats. The .gcsv log format described here is a simple to implement format suitable for basic motion loggers.","title":"Custom hardware/logger"},{"location":"logging/customlogger/#custom-and-diy-hardware-logging","text":"This page contains an example of how data logging can be implemented and existing projects you can build and/or adapt.","title":"Custom and DIY hardware logging"},{"location":"logging/customlogger/#existing-diy-options","text":"","title":"Existing DIY options"},{"location":"logging/customlogger/#esplog-by-vladimirp1","text":"A ESP32-based motion data logger with wireless control and data transfer. Available as a small breakout board version or a tiny single PCB version. The developer and testers of esplog can be found on the Gyroflow discord. esplog on Github","title":"esplog by VladimirP1"},{"location":"logging/customlogger/#flowshutter-and-flowbox-by-dusking1","text":"These are motion data loggers developed by Dusking1 using the Betaflight firmware. The Flowshutter is designed to be capable of triggering a variety of cameras for a one-click operation. Flowshutter on Github","title":"Flowshutter and Flowbox by Dusking1"},{"location":"logging/customlogger/#hardware","text":"An MEMS Inertial Measurement Unit (MEMS IMU) is a chip containing a gyroscope and an accelerometer. The gyroscope measures the rotational rate, while the accelerometer measures acceleration as the name implies. Gyroflow requires the gyroscope, while the accelerometer is optional and only required if horizon referencing is desired. An example of the acceleration and rotational axes around a camera is illustrated above. Many camera systems already contain such an IMU for electronic image stabilization, so in some cases, it is possible to allow for motion logging through a firmware update. For a dedicated logger, a simple combination of a memory device (MicroSD/SPI Flash chip etc.), a microcontroller, and an inertial measurement unit suffices. This hardware combination is readily available as low-cost drone flight controllers, which can act as loggers as described on another page . For arduino and embedded electronics hobbyists, this is a fairly basic project that can be built on a breadboard/perfboard","title":"Hardware"},{"location":"logging/customlogger/#softwarefirmware","text":"On the software and firmware side, the inertial measurement unit should be configured correctly. Refer to the datasheet of your IMU for information about how to configure this exactly. It has been found that the following IMU settings offer a reasonable starting point. logging rate: 500 Hz Low pass filter cutoff: 50 to 100 Hz gyro scaling: 1000 deg/s acceleration scaling: +/- 8 g The minimum logging rate sufficient for stabilization is approximately 100 Hz, but note that such a low logging rate requires excellent filtering in order to avoid data loss and aliasing. Using a 500 Hz logging rate with a 100 Hz cutoff allows for some margin of error in terms of aliasing.","title":"Software/Firmware"},{"location":"logging/customlogger/#logging","text":"Logging of Gyroscope, and optionally, Accelerometer and Magnetometer can be in various formats. The .gcsv log format described here is a simple to implement format suitable for basic motion loggers.","title":"Logging"},{"location":"logging/flowbox/","text":"Flowbox is an extremely compact gyro logger developed for using with Gyroflow. It has: USB-C connector STM32F411 MCU BMI270 IMU 128MB onboard SPI flash chip Onboard beeper 2 UARTs It is not yet available, but here's basic tutorial. Start with presets Since the flowbox is based on F411 MCU and BMI270 gyroscope, only betaflight 4.3 or newer firmware support it. We have a gyroflow-betaflight presets source for your convenience, and you can quickly set up your flowbox with \"one click\". Gyroflow-betaflight preset source can be easily set up followed the picture shown below: https://github.com/gyroflow/logger-presets Tranditional setup procedure Flash firmware The flashing procedure is pretty similar to other betaflight flight controllers. here's the step: Connect your flowbox to your computer. Open the latest betaflight configurator (version 10.8.0 or newer). Open \"Firmware Flasher\", search and choose \"flowbox\" in the target selector Select 4.3.0 or newer firmware version. Hit the \"Load Firmware [Online]\" button, then later hit the \"Flash Firmware\" button. Once the flashing progress is done, try to connect. The configurator will ask you whether apply the custom default. Click \"Apply Custom Default\" button. Then reconnect, whola! Settings It is recommended to use a single PT3 @80Hz on gyroscope data for this application usage. Also, the dynamic notch filter could be quite useful for hard mounted, but this would request to config the motor protocol to be Dshot300. feature DYNAMIC_FILTER set runaway_takeoff_prevention = OFF set pid_process_denom = 1 set motor_pwm_protocol = DSHOT300 set simplified_gyro_filter = OFF set gyro_lpf1_static_hz = 0 set gyro_lpf2_type = PT3 set gyro_lpf2_static_hz = 80 set gyro_lpf1_dyn_min_hz = 0 set gyro_lpf1_dyn_max_hz = 0 set simplified_gyro_filter = OFF This can also be done in GUI, but CLI command is easy and no bias. Logging trace Since flowbox was used as a secondary FC which only the gyro data is need, we can simply disable other \"useless\" log traces in order to save flash space and reduce log size. set blackbox_sample_rate = 1/16 set blackbox_disable_pids = ON set blackbox_disable_rc = ON set blackbox_disable_setpoint = ON set blackbox_disable_bat = ON set blackbox_disable_mag = ON set blackbox_disable_alt = ON set blackbox_disable_rssi = ON set blackbox_disable_acc = ON set blackbox_disable_debug = ON set blackbox_disable_motors = ON set blackbox_disable_gps = ON If you want to use gyroflow's \"horizon lock\" features: set blackbox_disable_acc = OFF Board orientation Based on your mounting, you should change the board orientation so for the board can record the correct motion data. Trigger the recording There are many ways to trigger the blackbox record, here we simply show you the mostly common used two ways. Triggered by receiver No trigger, record blackbox data automatically when power up By receiver Betaflight can record blackbox when the FC was ARMed. So you need to hook a serial receiver to a UART and set it up properly in betaflight configurator. Flowbox has two UARTs, which support a lot of serial receiver (not included SBUS protocol) include CRSF, iBUS, SRXL, etc. The pads are shown as below: Once the receiver is hooked up, you need to set the correspond UART and protocol. No trigger Betaflight can also record blackbox when the FC was powered up. Simply set the blackbox_mode = ALWAYS set blackbox_mode = ALWAYS Use with flowshutter Check flowshutter","title":"Flowbox"},{"location":"logging/flowbox/#start-with-presets","text":"Since the flowbox is based on F411 MCU and BMI270 gyroscope, only betaflight 4.3 or newer firmware support it. We have a gyroflow-betaflight presets source for your convenience, and you can quickly set up your flowbox with \"one click\". Gyroflow-betaflight preset source can be easily set up followed the picture shown below: https://github.com/gyroflow/logger-presets","title":"Start with presets"},{"location":"logging/flowbox/#tranditional-setup-procedure","text":"","title":"Tranditional setup procedure"},{"location":"logging/flowbox/#flash-firmware","text":"The flashing procedure is pretty similar to other betaflight flight controllers. here's the step: Connect your flowbox to your computer. Open the latest betaflight configurator (version 10.8.0 or newer). Open \"Firmware Flasher\", search and choose \"flowbox\" in the target selector Select 4.3.0 or newer firmware version. Hit the \"Load Firmware [Online]\" button, then later hit the \"Flash Firmware\" button. Once the flashing progress is done, try to connect. The configurator will ask you whether apply the custom default. Click \"Apply Custom Default\" button. Then reconnect, whola!","title":"Flash firmware"},{"location":"logging/flowbox/#settings","text":"It is recommended to use a single PT3 @80Hz on gyroscope data for this application usage. Also, the dynamic notch filter could be quite useful for hard mounted, but this would request to config the motor protocol to be Dshot300. feature DYNAMIC_FILTER set runaway_takeoff_prevention = OFF set pid_process_denom = 1 set motor_pwm_protocol = DSHOT300 set simplified_gyro_filter = OFF set gyro_lpf1_static_hz = 0 set gyro_lpf2_type = PT3 set gyro_lpf2_static_hz = 80 set gyro_lpf1_dyn_min_hz = 0 set gyro_lpf1_dyn_max_hz = 0 set simplified_gyro_filter = OFF This can also be done in GUI, but CLI command is easy and no bias.","title":"Settings"},{"location":"logging/flowbox/#logging-trace","text":"Since flowbox was used as a secondary FC which only the gyro data is need, we can simply disable other \"useless\" log traces in order to save flash space and reduce log size. set blackbox_sample_rate = 1/16 set blackbox_disable_pids = ON set blackbox_disable_rc = ON set blackbox_disable_setpoint = ON set blackbox_disable_bat = ON set blackbox_disable_mag = ON set blackbox_disable_alt = ON set blackbox_disable_rssi = ON set blackbox_disable_acc = ON set blackbox_disable_debug = ON set blackbox_disable_motors = ON set blackbox_disable_gps = ON If you want to use gyroflow's \"horizon lock\" features: set blackbox_disable_acc = OFF","title":"Logging trace"},{"location":"logging/flowbox/#board-orientation","text":"Based on your mounting, you should change the board orientation so for the board can record the correct motion data.","title":"Board orientation"},{"location":"logging/flowbox/#trigger-the-recording","text":"There are many ways to trigger the blackbox record, here we simply show you the mostly common used two ways. Triggered by receiver No trigger, record blackbox data automatically when power up","title":"Trigger the recording"},{"location":"logging/flowbox/#by-receiver","text":"Betaflight can record blackbox when the FC was ARMed. So you need to hook a serial receiver to a UART and set it up properly in betaflight configurator. Flowbox has two UARTs, which support a lot of serial receiver (not included SBUS protocol) include CRSF, iBUS, SRXL, etc. The pads are shown as below: Once the receiver is hooked up, you need to set the correspond UART and protocol.","title":"By receiver"},{"location":"logging/flowbox/#no-trigger","text":"Betaflight can also record blackbox when the FC was powered up. Simply set the blackbox_mode = ALWAYS set blackbox_mode = ALWAYS","title":"No trigger"},{"location":"logging/flowbox/#use-with-flowshutter","text":"Check flowshutter","title":"Use with flowshutter"},{"location":"logging/flowshutter/","text":"Flowshutter is a custom camera remote. When used in conjunction with readily available hardware, this results in a flexible and reliable external camera motion logger for Gyroflow. It can provide precise synchronization of camera video recording and motion logger (betaflight/emuflight FC) recording. It was designed to be used with the Gyroflow software to provide you one of the best open source video stabilization experiences.","title":"Flowshutter"},{"location":"logging/gbin/","text":"Warning This reference is not complete and should not currently be followed On the previous page, the .gcsv format was described. The text-based CSV file has the advantage of being easily formatted and human-read, but the disadvantage of taking up significantly more space that what is required for just the raw data. For instance, a 16-bit or two byte number may take up around 7 bytes due to each decimal being one byte. For this reason, this page describes an alternative format dubbed .gbin . This is a binary format and thus significantly more compared than the .gcsv format. Header In order to allow for easy identification of the main parameters without decoding the file, the same ASCII header as the .gcsv format is used. GYROFLOW GBIN LOG version,1.1 id,custom_logger_name orientation,YxZ note,development_test fwversion,FIRMWARE_0.1.0 timestamp,1644159993 vendor,potatocam videofilename,videofilename.mp4 lensprofile,potatocam_mark1_prime_7_5mm_4k tscale,0.001 gscale,0.00122173047 ascale,0.00048828125 DATA: t,gx,gy,gz,ax,ay,az 0,39,86,183,-1137,-15689,-2986 1,56,100,202,-1179,-15694,-2887 2,63,108,218,-1247,-15702,-2794 3,71,108,243,-1308,-15675,-2727 4,83,101,268,-1420,-15662,-2661 The next is the data: [0xAA][32-bit uint32 time][3x int16][3x int16][3x int16] Behavior of the parser: Start reading, when done, check if the separator is present.","title":"Gbin"},{"location":"logging/gbin/#header","text":"In order to allow for easy identification of the main parameters without decoding the file, the same ASCII header as the .gcsv format is used. GYROFLOW GBIN LOG version,1.1 id,custom_logger_name orientation,YxZ note,development_test fwversion,FIRMWARE_0.1.0 timestamp,1644159993 vendor,potatocam videofilename,videofilename.mp4 lensprofile,potatocam_mark1_prime_7_5mm_4k tscale,0.001 gscale,0.00122173047 ascale,0.00048828125 DATA: t,gx,gy,gz,ax,ay,az 0,39,86,183,-1137,-15689,-2986 1,56,100,202,-1179,-15694,-2887 2,63,108,218,-1247,-15702,-2794 3,71,108,243,-1308,-15675,-2727 4,83,101,268,-1420,-15662,-2661 The next is the data: [0xAA][32-bit uint32 time][3x int16][3x int16][3x int16] Behavior of the parser: Start reading, when done, check if the separator is present.","title":"Header"},{"location":"logging/gcsv/","text":".gcsv gyro log format What follows is a text-based gyro log format that can be implemented in custom hardware/firmware called .gcsv (short for gyro csv or Gyroflow csv). As a text-based format this is meant to be easily implementable and inspectable (compatible with standard CSV reading software) at the cost of space efficiency. Firstly, for a video file called videofilename.mp4 , the corresponding gyro log file is videofilename.gcsv , this is a case of the .gcsv acting as sidecar files . This allows for automatic log detection. The .gcsv file contains information about the gyro orientation, scaling, and a unique identifier. The following is an example of a .gcsv file from a logger supporting logging of gyro and accelerometer: GYROFLOW IMU LOG version,1.3 id,custom_logger_name orientation,YxZ note,development_test fwversion,FIRMWARE_0.1.0 timestamp,1644159993 vendor,potatocam videofilename,videofilename.mp4 lensprofile,potatocam/potatocam_mark1_prime_7_5mm_4k lens_info,wide frame_readout_time,15.23 frame_readout_direction,0 tscale,0.001 gscale,0.00122173047 ascale,0.00048828125 t,gx,gy,gz,ax,ay,az 0,39,86,183,-1137,-15689,-2986 1,56,100,202,-1179,-15694,-2887 2,63,108,218,-1247,-15702,-2794 3,71,108,243,-1308,-15675,-2727 4,83,101,268,-1420,-15662,-2661 5,101,93,294,-1575,-15661,-2629 6,121,95,319,-1677,-15654,-2639 7,143,97,348,-1709,-15673,-2654 8,163,98,362,-1704,-15691,-2685 9,173,93,371,-1678,-15698,-2736 10,181,98,375,-1623,-15697,-2810 11,173,105,365,-1578,-15693,-2929 12,159,111,363,-1555,-15711,-3057 13,157,113,348,-1540,-15747,-3159 14,157,118,327,-1542,-15780,-3246 15,153,123,310,-1595,-15812,-3319 ... If a magnetometer is present, some additional fields are present, e.g.: GYROFLOW IMU LOG version,1.3 id,custom_logger_name orientation,YxZ note,development_test fwversion,FIRMWARE_0.1.0 timestamp,1644159993 vendor,potatocam videofilename,videofilename.mp4 lensprofile,potatocam_mark1_prime_7_5mm_4k tscale,0.001 gscale,0.00122173047 ascale,0.00048828125 mscale,0.00059875488 t,gx,gy,gz,ax,ay,az,mx,my,mz 0,39,86,183,-1137,-15689,-2986,123,345,546 1,56,100,202,-1179,-15694,-2887,124,344,560 ... Mandatory fields: The very first line identifies the file as an IMU log. This line should either be GYROFLOW IMU LOG or the more neutral CAMERA IMU LOG . The second line version,1.3 describes the \"version\" of the .gcsv file format. This is equal to 1.3 for now. The versions are backwards compatible, but changes with the addition of new metadata fields. The third line contains a unique ID associated with the logger/camera. For instance a high-end camera with internal logging may use id,potatocam_deluxe_4k_grey_edition . The fourth line contains the orientation string. This corresponds to the IMU Orientation field in Gyroflow (see the implementation notes below for further details). The next few lines contain optional metadata. These are not strictly required, but may improve workflow and stabilization. Developers are thus encouraged to include all known fields. The subsequent lines with tscale , ascale and gscale describe constants used to scale the raw sensor values. Multiplying tscale by the raw t values should give the time in seconds . It can thus be deduced that the file above is logging at 1000 Hz since each line increments by 1*0.001=0.001 s , corresponding to a frequency of 1 KHz. The resolution of the timestamps should be 1 ms or better. Multiplying gscale by the raw gx/gy/gz values should give the angular rate in rad/s (If accelerometer data present) Multiplying ascale by the raw ax/ay/az values should give the acceleration in g (If magnetometer data present) Multiplying mscale by mx/my/mz gives the measurements in gauss (Note that 1 tesla = 10000 gauss ). The rest of the file simply consists of a standard CSV header and the raw values. The header and data order should be one of the following: t,gx,gy,gz , t,gx,gy,gz,ax,ay,az , or t,gx,gy,gz,ax,ay,az,mx,my,mz . Gyroscope data is the minimum requirement. Acceleration data is required for horizon lock, while magnetometer data improves drift in orientation determination (Not currently of significant importance). For the data itself, fixed-point integers are recommended with a scalar (point 6) in order to avoid excessively large text files. Using floating points here is still valid though. Optional fields: The following are all optional fields for the metadata block, but developers should include as many known fields as possible. Note is for other misc. information. fwversion is the firmware of the logger/camera. timestamp is the unix timestamp when logging began. vendor can contain the vendor or developer videofilename is the name of the corresponding video file. Normally the .gcsv file name already matches, but this insures the information is kept if the filename changes. lensprofile is the unique name of the lens preset and vendor folder. If it matches a lens profile in the database it is automatically selected during loading. lens_info is additional information about the lens/field of view not available in the metadata. This could be wide , normal , narrow for different FOV settings, linear for lens distortion correction. Most relevant for action cameras with different crop settings. frame_readout_time is the time in milliseconds it takes to capture a full video frame using rolling shutter. This is used for rolling shutter correction. frame_readout_direction is the direction of the readout. Most cameras with rolling shutter capture the top of the frame first. Note that Gyroflow currently only supports correcting 0 and 1. 0: Top to bottom 1: Bottom to top 2: Left to right 3: Right to left Implementation notes The required parts of the header of the .gcsv file remains static for a given camera/setup, and can thus be written as a constant string to the file. Raw sensor values are often represented as 16-bit signed integers, meaning a range between of +/- 2^15 . If the acceleration range is known to be +/- 4 g as was the case in the example above. Then ascale = 4/2^15 = 0.00012207031 . Refer to the datasheet for conversion information. Similarly, a gyroscope with a range of +/- 1000 deg/s gives gscale = (1000 * pi / 180)/2^15 = 0.00053263221 . Note that even when configured to a setting such as +/- 1000 deg/s , the actual calibration of the sensor may lead to a maximum slightly above or below this value. As always, consult the datasheet. For a logger/camera implementation, some other things to think about: For a camera, the timestamps should be based on the same time source as the video capture. This prevents drift between the two. Consider using microseconds for the timestamp if a faster sampling rate if the time source allows. This may improve the timing during the sync process. Consider using the data ready interrupts of IMU's instead of polling for more consistent timings. Ensure proper filtering of the data to meet the Nyquist criteria for the samling frequency. Even more filtering is usually recommended, e.g. setting the builtin hardware low pass filter cutoff at 50 Hz to 100 Hz is a good starting point, even for higher sampling frequencies. For the IMU Orientation string, the following figure corresponds to YxZ . For the gyroscope, data for an axis correspond to the right-handed rotation rate of the camera body about that axis. The accelerometer data correspond to linear acceleration applied in the given direction. Due to the nature of gravity, a stationary object will experience an upwards acceleration of 9.81 m/s 2 , while an object in freefall will experience zero acceleration. The magnetometer data corresponds to the measured magnetic field vector. In order for orientation determination to work correctly, the data must have the same/aligned coordinate axes. For combined IMU sensors, this is already the case for the raw data. If a rotation is applied to the gyro data before being written, the same rotation should be applied to the accelerometer (and magnetometer). This ensures that the axes stay aligned. If the gyroscope and accelerometer data come from separate sensors, their axes must similarly be aligned, either physically or by applying a rotation in software. Version changelog 1.0: Initial version 1.1: Add lens profile field 1.2: Add rolling shutter information 1.3: Add lens_info field","title":"Gyroflow .gcsv reference"},{"location":"logging/gcsv/#gcsv-gyro-log-format","text":"What follows is a text-based gyro log format that can be implemented in custom hardware/firmware called .gcsv (short for gyro csv or Gyroflow csv). As a text-based format this is meant to be easily implementable and inspectable (compatible with standard CSV reading software) at the cost of space efficiency. Firstly, for a video file called videofilename.mp4 , the corresponding gyro log file is videofilename.gcsv , this is a case of the .gcsv acting as sidecar files . This allows for automatic log detection. The .gcsv file contains information about the gyro orientation, scaling, and a unique identifier. The following is an example of a .gcsv file from a logger supporting logging of gyro and accelerometer: GYROFLOW IMU LOG version,1.3 id,custom_logger_name orientation,YxZ note,development_test fwversion,FIRMWARE_0.1.0 timestamp,1644159993 vendor,potatocam videofilename,videofilename.mp4 lensprofile,potatocam/potatocam_mark1_prime_7_5mm_4k lens_info,wide frame_readout_time,15.23 frame_readout_direction,0 tscale,0.001 gscale,0.00122173047 ascale,0.00048828125 t,gx,gy,gz,ax,ay,az 0,39,86,183,-1137,-15689,-2986 1,56,100,202,-1179,-15694,-2887 2,63,108,218,-1247,-15702,-2794 3,71,108,243,-1308,-15675,-2727 4,83,101,268,-1420,-15662,-2661 5,101,93,294,-1575,-15661,-2629 6,121,95,319,-1677,-15654,-2639 7,143,97,348,-1709,-15673,-2654 8,163,98,362,-1704,-15691,-2685 9,173,93,371,-1678,-15698,-2736 10,181,98,375,-1623,-15697,-2810 11,173,105,365,-1578,-15693,-2929 12,159,111,363,-1555,-15711,-3057 13,157,113,348,-1540,-15747,-3159 14,157,118,327,-1542,-15780,-3246 15,153,123,310,-1595,-15812,-3319 ... If a magnetometer is present, some additional fields are present, e.g.: GYROFLOW IMU LOG version,1.3 id,custom_logger_name orientation,YxZ note,development_test fwversion,FIRMWARE_0.1.0 timestamp,1644159993 vendor,potatocam videofilename,videofilename.mp4 lensprofile,potatocam_mark1_prime_7_5mm_4k tscale,0.001 gscale,0.00122173047 ascale,0.00048828125 mscale,0.00059875488 t,gx,gy,gz,ax,ay,az,mx,my,mz 0,39,86,183,-1137,-15689,-2986,123,345,546 1,56,100,202,-1179,-15694,-2887,124,344,560 ...","title":".gcsv gyro log format"},{"location":"logging/gcsv/#mandatory-fields","text":"The very first line identifies the file as an IMU log. This line should either be GYROFLOW IMU LOG or the more neutral CAMERA IMU LOG . The second line version,1.3 describes the \"version\" of the .gcsv file format. This is equal to 1.3 for now. The versions are backwards compatible, but changes with the addition of new metadata fields. The third line contains a unique ID associated with the logger/camera. For instance a high-end camera with internal logging may use id,potatocam_deluxe_4k_grey_edition . The fourth line contains the orientation string. This corresponds to the IMU Orientation field in Gyroflow (see the implementation notes below for further details). The next few lines contain optional metadata. These are not strictly required, but may improve workflow and stabilization. Developers are thus encouraged to include all known fields. The subsequent lines with tscale , ascale and gscale describe constants used to scale the raw sensor values. Multiplying tscale by the raw t values should give the time in seconds . It can thus be deduced that the file above is logging at 1000 Hz since each line increments by 1*0.001=0.001 s , corresponding to a frequency of 1 KHz. The resolution of the timestamps should be 1 ms or better. Multiplying gscale by the raw gx/gy/gz values should give the angular rate in rad/s (If accelerometer data present) Multiplying ascale by the raw ax/ay/az values should give the acceleration in g (If magnetometer data present) Multiplying mscale by mx/my/mz gives the measurements in gauss (Note that 1 tesla = 10000 gauss ). The rest of the file simply consists of a standard CSV header and the raw values. The header and data order should be one of the following: t,gx,gy,gz , t,gx,gy,gz,ax,ay,az , or t,gx,gy,gz,ax,ay,az,mx,my,mz . Gyroscope data is the minimum requirement. Acceleration data is required for horizon lock, while magnetometer data improves drift in orientation determination (Not currently of significant importance). For the data itself, fixed-point integers are recommended with a scalar (point 6) in order to avoid excessively large text files. Using floating points here is still valid though.","title":"Mandatory fields:"},{"location":"logging/gcsv/#optional-fields","text":"The following are all optional fields for the metadata block, but developers should include as many known fields as possible. Note is for other misc. information. fwversion is the firmware of the logger/camera. timestamp is the unix timestamp when logging began. vendor can contain the vendor or developer videofilename is the name of the corresponding video file. Normally the .gcsv file name already matches, but this insures the information is kept if the filename changes. lensprofile is the unique name of the lens preset and vendor folder. If it matches a lens profile in the database it is automatically selected during loading. lens_info is additional information about the lens/field of view not available in the metadata. This could be wide , normal , narrow for different FOV settings, linear for lens distortion correction. Most relevant for action cameras with different crop settings. frame_readout_time is the time in milliseconds it takes to capture a full video frame using rolling shutter. This is used for rolling shutter correction. frame_readout_direction is the direction of the readout. Most cameras with rolling shutter capture the top of the frame first. Note that Gyroflow currently only supports correcting 0 and 1. 0: Top to bottom 1: Bottom to top 2: Left to right 3: Right to left","title":"Optional fields:"},{"location":"logging/gcsv/#implementation-notes","text":"The required parts of the header of the .gcsv file remains static for a given camera/setup, and can thus be written as a constant string to the file. Raw sensor values are often represented as 16-bit signed integers, meaning a range between of +/- 2^15 . If the acceleration range is known to be +/- 4 g as was the case in the example above. Then ascale = 4/2^15 = 0.00012207031 . Refer to the datasheet for conversion information. Similarly, a gyroscope with a range of +/- 1000 deg/s gives gscale = (1000 * pi / 180)/2^15 = 0.00053263221 . Note that even when configured to a setting such as +/- 1000 deg/s , the actual calibration of the sensor may lead to a maximum slightly above or below this value. As always, consult the datasheet. For a logger/camera implementation, some other things to think about: For a camera, the timestamps should be based on the same time source as the video capture. This prevents drift between the two. Consider using microseconds for the timestamp if a faster sampling rate if the time source allows. This may improve the timing during the sync process. Consider using the data ready interrupts of IMU's instead of polling for more consistent timings. Ensure proper filtering of the data to meet the Nyquist criteria for the samling frequency. Even more filtering is usually recommended, e.g. setting the builtin hardware low pass filter cutoff at 50 Hz to 100 Hz is a good starting point, even for higher sampling frequencies. For the IMU Orientation string, the following figure corresponds to YxZ . For the gyroscope, data for an axis correspond to the right-handed rotation rate of the camera body about that axis. The accelerometer data correspond to linear acceleration applied in the given direction. Due to the nature of gravity, a stationary object will experience an upwards acceleration of 9.81 m/s 2 , while an object in freefall will experience zero acceleration. The magnetometer data corresponds to the measured magnetic field vector. In order for orientation determination to work correctly, the data must have the same/aligned coordinate axes. For combined IMU sensors, this is already the case for the raw data. If a rotation is applied to the gyro data before being written, the same rotation should be applied to the accelerometer (and magnetometer). This ensures that the axes stay aligned. If the gyroscope and accelerometer data come from separate sensors, their axes must similarly be aligned, either physically or by applying a rotation in software.","title":"Implementation notes"},{"location":"logging/gcsv/#version-changelog","text":"1.0: Initial version 1.1: Add lens profile field 1.2: Add rolling shutter information 1.3: Add lens_info field","title":"Version changelog"},{"location":"logging/general/","text":"Gyroflow needs a source of gyroscope data (and optionally accelerometer data) to operate. Currently, Gyroflow supports the following gyro log types: Supported formats: GoPro (All models with gyro metadata, starting with HERO 5) Sony (a1, a7c, a7r IV, a7 IV, a7s III, a9 II, FX3, FX6, RX0 II, RX100 VII, ZV1, ZV-E10) Insta360 (OneR, SMO 4k, GO2) Betaflight blackbox (CSV and binary) Runcam CSV (Runcam 5 Orange, iFlight GOCam GR) Hawkeye Firefly X Lite CSV WitMotion (WT901SDCL binary and *.txt) Mobile apps: Sensor Logger , G-Field Recorder , Gyro Gyroflow .gcsv log ArduPilot VideoStabilization logging (*.log) (TODO) DJI flight logs ( .dat, .txt) The subsequent pages will contain information about specific logging methods.","title":"General"},{"location":"logging/general/#supported-formats","text":"GoPro (All models with gyro metadata, starting with HERO 5) Sony (a1, a7c, a7r IV, a7 IV, a7s III, a9 II, FX3, FX6, RX0 II, RX100 VII, ZV1, ZV-E10) Insta360 (OneR, SMO 4k, GO2) Betaflight blackbox (CSV and binary) Runcam CSV (Runcam 5 Orange, iFlight GOCam GR) Hawkeye Firefly X Lite CSV WitMotion (WT901SDCL binary and *.txt) Mobile apps: Sensor Logger , G-Field Recorder , Gyro Gyroflow .gcsv log ArduPilot VideoStabilization logging (*.log) (TODO) DJI flight logs ( .dat, .txt) The subsequent pages will contain information about specific logging methods.","title":"Supported formats:"},{"location":"logging/orientation/","text":"In order to find the IMU orientation, the following approach can be used. Essentially, by moving the system in a known order, the observed gyro/accelerometer signal can be compared to teh correct one. Firstly, the \"standard\" Gyroflow input orientation is defined as follows. Suppose a camera is pointed with the lens forwards in a horizontal orientation. The z vector is then pointed backwards, the x vector pointed upwards, and the y vector pointed to the left. This is illustrated in the figure below. The measured accelerations and angular rates are assumed to be aligned. Find orientation for existing footage If you have captured footage with an unknown orientation, it is also possible to deduce the correct orientation based on the video and gyro data.","title":"Orientation"},{"location":"logging/orientation/#find-orientation-for-existing-footage","text":"If you have captured footage with an unknown orientation, it is also possible to deduce the correct orientation based on the video and gyro data.","title":"Find orientation for existing footage"},{"location":"tech/filtering/","text":"For video stabilization, logging rates of at least 100 Hz of clean data has shown to work, with clean being the keyword. This page contains some info about the quality of the gyro data. Aliasing For number one, adequate filtering should be applied before the saving step in order to satisfy the Nyquist\u2013Shannon sampling theorem . This may sound fancy, but just means the frequencies in the signal should be limited to at most, half the sampling frequency. For a 200 Hz logging rate, a low pass/decimation filter with a cutoff of about 100 Hz should be applied. Most MEMS gyroscopes contain on-board options for low pass filtering, but depending on the exact chip, this may not be adequate for handling harsh vibration-heavy environments on a drone. Gyro-camera coupling The physical gyro should match the motion of the camera, meaning no or minimal play should be present between the two. This is not a problem for built-in gyro logging case. Filtering If no aliasing is present, the gyro data can be further filtered, assuming the sampling rate is sufficiently high. Roughly speaking, the frequencies of camera shake lie below 50 Hz. Frequencies above this could either be noise or high frequency signals resulting from high frequency, but low amplitude vibrations.","title":"Filtering and noise"},{"location":"tech/filtering/#aliasing","text":"For number one, adequate filtering should be applied before the saving step in order to satisfy the Nyquist\u2013Shannon sampling theorem . This may sound fancy, but just means the frequencies in the signal should be limited to at most, half the sampling frequency. For a 200 Hz logging rate, a low pass/decimation filter with a cutoff of about 100 Hz should be applied. Most MEMS gyroscopes contain on-board options for low pass filtering, but depending on the exact chip, this may not be adequate for handling harsh vibration-heavy environments on a drone.","title":"Aliasing"},{"location":"tech/filtering/#gyro-camera-coupling","text":"The physical gyro should match the motion of the camera, meaning no or minimal play should be present between the two. This is not a problem for built-in gyro logging case.","title":"Gyro-camera coupling"},{"location":"tech/filtering/#filtering","text":"If no aliasing is present, the gyro data can be further filtered, assuming the sampling rate is sufficiently high. Roughly speaking, the frequencies of camera shake lie below 50 Hz. Frequencies above this could either be noise or high frequency signals resulting from high frequency, but low amplitude vibrations.","title":"Filtering"},{"location":"tech/relatedprojects/","text":"This page contains projects and technical literature which may be of interest to those wanting to learn more about gyro-based video stabilization. Gyro-assisted video stabilization projects Legacy Python-version of Gyroflow Virtual Gimbal by Yoshiaki Sato. Another gyro-assisted stabilization tool Video-Stabilization by Alex Karpenko. One of the first implementations of the method Papers Digital Video Stabilization and Rolling Shutter Correction using Gyroscopes - 2011 paper describing gyro-assisted video stabilization Animating Rotation with Quaternion Curves - Describes SLERP, used for orientation smoothing in Gyroflow A Generic Camera Model and Calibration Method for Conventional, Wide-Angle, and Fish-Eye Lenses - the default lens model used in Gyroflow Online Gyroscope-Camera Autocalibration for Image Enhancement on Smartphones - Master Thesis about gyro-assisted video stabilization","title":"Related Projects/Literature"},{"location":"tech/relatedprojects/#gyro-assisted-video-stabilization-projects","text":"Legacy Python-version of Gyroflow Virtual Gimbal by Yoshiaki Sato. Another gyro-assisted stabilization tool Video-Stabilization by Alex Karpenko. One of the first implementations of the method","title":"Gyro-assisted video stabilization projects"},{"location":"tech/relatedprojects/#papers","text":"Digital Video Stabilization and Rolling Shutter Correction using Gyroscopes - 2011 paper describing gyro-assisted video stabilization Animating Rotation with Quaternion Curves - Describes SLERP, used for orientation smoothing in Gyroflow A Generic Camera Model and Calibration Method for Conventional, Wide-Angle, and Fish-Eye Lenses - the default lens model used in Gyroflow Online Gyroscope-Camera Autocalibration for Image Enhancement on Smartphones - Master Thesis about gyro-assisted video stabilization","title":"Papers"},{"location":"tech/rollingshutter/","text":"Rolling shutter artifacts are caused by camera sensors reading lines sequentially instead of simultaneously (global shutter). With the correct settings, Gyroflow is capable of correcting for rolling shutter artifacts. Frame readout time determination There are multiple ways of determining the frame readout time. One approach is by recording a rapidly flashing source of light with a known frequency or pulse width, and analyzing the resulting image. For a known pulse width, the size of the bands can be used in order to find the frame readout time. For a known frequency, the number of bands can be counted. Using LED's for rolling shutter measurements is described in this blog post: https://joancharmant.com/blog/measuring-rolling-shutter-with-a-strobing-led/","title":"Rolling Shutter"},{"location":"tech/rollingshutter/#frame-readout-time-determination","text":"There are multiple ways of determining the frame readout time. One approach is by recording a rapidly flashing source of light with a known frequency or pulse width, and analyzing the resulting image. For a known pulse width, the size of the bands can be used in order to find the frame readout time. For a known frequency, the number of bands can be counted. Using LED's for rolling shutter measurements is described in this blog post: https://joancharmant.com/blog/measuring-rolling-shutter-with-a-strobing-led/","title":"Frame readout time determination"},{"location":"tech/smoothing/","text":"In order to stabilize the orientation, a smoothing algorithm is used. This is in essence a low pass filter applied to the 3D orientation. To illustrate how this works, let's take one of the simplest low pass filters in 1D: the exponential filter , also known as exponential moving average or exponentially weighted moving average depending on the field of study (see the wikipedia article for more info). If \\(\\alpha\\) be a number between 0 and 1 and the \\(Y_t\\) being the t-th input sample. The output, \\(S_t\\) of this low pass filter is then: \\[ {\\displaystyle S_{t}={\\begin{cases}Y_{1},&t=0\\\\\\alpha Y_{t}+(1-\\alpha )\\cdot S_{t-1},&t>0\\end{cases}}} \\] This can be seen as a weighted average between the previous output and the newest input sample. Alternatively this can be seen as the output moving a fractional amount towards to input for each sample. The result is a smoothed 1D signal, but introduces a delay in the signal. By applying the same filter twice in opposite directions, this delay is eliminated. Now, how can this be expanded to 3D? A three-dimensional orientation needs to be represented by at least three numbers, so one obvious way of filtering the orientation is to apply the low pass filter to each axis. Although this works, the result might not be the smoothing you expect. For instance, if the orientation is represented by an Euler angle, applying a low pass filter to each axis leads to non-linear behavior in the resulting orientation. If instead the orientations are represented by quaternions, the Slerp (Spherical Linear Interpolation, wiki article ) method invented by Ken Shoemake can be used. Slerp can compute the intermediate orientation (quaternion) between two original quaternions corresponding to a smooth trajectory between the two. This is exactly what's needed for the simple exponential smoothing, since the weighted sum is equivalent to starting at \\(Y_{t}\\) and moving a fractional distance of \\(\\alpha\\) towards \\(S_{t-1}\\) . This filter can thus be translated to an orientation filter as follows: \\[ {\\displaystyle q_{out,t}={\\begin{cases}q_{in,t},&t=0\\\\Slerp(q_{in,t}, q_{out,t-1},\\alpha) ,&t>0\\end{cases}}} \\] Once again, this is applied in both directions to counteract the introduced delay. The difference between the input quaternions (estimated camera motion) and output quaternions (smoothed virtual camera) is then used for the image stabilization process. Due to the simplicity, this orientation filter was the first one implemented in the Gyroflow project, but has a number of limitations, mainly during large camera shakes and the lack of smoothness control for each rotational axis. Nevertheless, you should now have an overview of how the general smoothing algorithm works (Input orientation quaternions -> Smoothing algo -> Smoothed orientation quaternions) which might give you ideas for your own smoothing algorithm.","title":"Orientations and smoothing"}]}